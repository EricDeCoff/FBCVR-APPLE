function parseParameters(e){var t={maximumAge:0,enableHighAccuracy:!1,timeout:1/0};return e&&(void 0!==e.maximumAge&&!isNaN(e.maximumAge)&&e.maximumAge>0&&(t.maximumAge=e.maximumAge),void 0!==e.enableHighAccuracy&&(t.enableHighAccuracy=e.enableHighAccuracy),void 0===e.timeout||isNaN(e.timeout)||(t.timeout=e.timeout<0?0:e.timeout)),t}function createTimeout(e,t){var i=setTimeout(function(){clearTimeout(i),i=null,e({code:PositionError.TIMEOUT,message:"Position retrieval timed out."})},t);return i}var argscheck=require("cordova/argscheck"),utils=require("cordova/utils"),exec=require("cordova/exec"),PositionError=require("./PositionError"),Position=require("./Position"),timers={},geolocation={lastPosition:null,getCurrentPosition:function(e,t,i){argscheck.checkArgs("fFO","geolocation.getCurrentPosition",arguments),i=parseParameters(i);var o={timer:null},a=function(t){if(clearTimeout(o.timer),o.timer){var i=new Position({latitude:t.latitude,longitude:t.longitude,altitude:t.altitude,accuracy:t.accuracy,heading:t.heading,velocity:t.velocity,altitudeAccuracy:t.altitudeAccuracy},void 0===t.timestamp?new Date:t.timestamp instanceof Date?t.timestamp:new Date(t.timestamp));geolocation.lastPosition=i,e(i)}},r=function(e){clearTimeout(o.timer),o.timer=null;var i=new PositionError(e.code,e.message);t&&t(i)};return geolocation.lastPosition&&i.maximumAge&&(new Date).getTime()-geolocation.lastPosition.timestamp.getTime()<=i.maximumAge?e(geolocation.lastPosition):0===i.timeout?r({code:PositionError.TIMEOUT,message:"timeout value in PositionOptions set to 0 and no cached Position object available, or cached Position object's age exceeds provided PositionOptions' maximumAge parameter."}):(o.timer=1/0!==i.timeout?createTimeout(r,i.timeout):!0,exec(a,r,"Geolocation","getLocation",[i.enableHighAccuracy,i.maximumAge])),o},watchPosition:function(e,t,i){argscheck.checkArgs("fFO","geolocation.getCurrentPosition",arguments),i=parseParameters(i);var o=utils.createUUID();timers[o]=geolocation.getCurrentPosition(e,t,i);var a=function(e){clearTimeout(timers[o].timer);var i=new PositionError(e.code,e.message);t&&t(i)},r=function(t){clearTimeout(timers[o].timer),1/0!==i.timeout&&(timers[o].timer=createTimeout(a,i.timeout));var r=new Position({latitude:t.latitude,longitude:t.longitude,altitude:t.altitude,accuracy:t.accuracy,heading:t.heading,velocity:t.velocity,altitudeAccuracy:t.altitudeAccuracy},void 0===t.timestamp?new Date:t.timestamp instanceof Date?t.timestamp:new Date(t.timestamp));geolocation.lastPosition=r,e(r)};return exec(r,a,"Geolocation","addWatch",[o,i.enableHighAccuracy]),o},clearWatch:function(e){e&&void 0!==timers[e]&&(clearTimeout(timers[e].timer),timers[e].timer=!1,exec(null,null,"Geolocation","clearWatch",[e]))}};module.exports=geolocation;