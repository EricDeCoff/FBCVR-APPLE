var cordova=require("cordova"),Media=require("org.apache.cordova.media.Media"),MediaError=require("org.apache.cordova.media.MediaError"),audioObjects={};module.exports={create:function(e,o,i){var a=i[0],t=i[1];console.log("media::create() - id ="+a+", src ="+t),audioObjects[a]=new Audio(t),audioObjects[a].onStalledCB=function(){console.log("media::onStalled()"),audioObjects[a].timer=window.setTimeout(function(){audioObjects[a].pause(),0!==audioObjects[a].currentTime&&(audioObjects[a].currentTime=0),console.log("media::onStalled() - MEDIA_ERROR -> "+MediaError.MEDIA_ERR_ABORTED);var e=new MediaError(MediaError.MEDIA_ERR_ABORTED,"Stalled");Media.onStatus(a,Media.MEDIA_ERROR,e)},2e3)},audioObjects[a].onEndedCB=function(){console.log("media::onEndedCB() - MEDIA_STATE -> MEDIA_STOPPED"),Media.onStatus(a,Media.MEDIA_STATE,Media.MEDIA_STOPPED)},audioObjects[a].onErrorCB=function(){console.log("media::onErrorCB() - MEDIA_ERROR -> "+event.srcElement.error),Media.onStatus(a,Media.MEDIA_ERROR,event.srcElement.error)},audioObjects[a].onPlayCB=function(){console.log("media::onPlayCB() - MEDIA_STATE -> MEDIA_STARTING"),Media.onStatus(a,Media.MEDIA_STATE,Media.MEDIA_STARTING)},audioObjects[a].onPlayingCB=function(){console.log("media::onPlayingCB() - MEDIA_STATE -> MEDIA_RUNNING"),Media.onStatus(a,Media.MEDIA_STATE,Media.MEDIA_RUNNING)},audioObjects[a].onDurationChangeCB=function(){console.log("media::onDurationChangeCB() - MEDIA_DURATION -> "+audioObjects[a].duration),Media.onStatus(a,Media.MEDIA_DURATION,audioObjects[a].duration)},audioObjects[a].onTimeUpdateCB=function(){console.log("media::onTimeUpdateCB() - MEDIA_POSITION -> "+audioObjects[a].currentTime),Media.onStatus(a,Media.MEDIA_POSITION,audioObjects[a].currentTime)},audioObjects[a].onCanPlayCB=function(){console.log("media::onCanPlayCB()"),window.clearTimeout(audioObjects[a].timer),audioObjects[a].play()}},startPlayingAudio:function(e,o,i){var a=i[0],t=i[1],n=i[2];console.log("media::startPlayingAudio() - id ="+a+", src ="+t+", options ="+n),audioObjects[a].addEventListener("canplay",audioObjects[a].onCanPlayCB),audioObjects[a].addEventListener("ended",audioObjects[a].onEndedCB),audioObjects[a].addEventListener("timeupdate",audioObjects[a].onTimeUpdateCB),audioObjects[a].addEventListener("durationchange",audioObjects[a].onDurationChangeCB),audioObjects[a].addEventListener("playing",audioObjects[a].onPlayingCB),audioObjects[a].addEventListener("play",audioObjects[a].onPlayCB),audioObjects[a].addEventListener("error",audioObjects[a].onErrorCB),audioObjects[a].addEventListener("stalled",audioObjects[a].onStalledCB),audioObjects[a].play()},stopPlayingAudio:function(e,o,i){var a=i[0];window.clearTimeout(audioObjects[a].timer),audioObjects[a].pause(),0!==audioObjects[a].currentTime&&(audioObjects[a].currentTime=0),console.log("media::stopPlayingAudio() - MEDIA_STATE -> MEDIA_STOPPED"),Media.onStatus(a,Media.MEDIA_STATE,Media.MEDIA_STOPPED),audioObjects[a].removeEventListener("canplay",audioObjects[a].onCanPlayCB),audioObjects[a].removeEventListener("ended",audioObjects[a].onEndedCB),audioObjects[a].removeEventListener("timeupdate",audioObjects[a].onTimeUpdateCB),audioObjects[a].removeEventListener("durationchange",audioObjects[a].onDurationChangeCB),audioObjects[a].removeEventListener("playing",audioObjects[a].onPlayingCB),audioObjects[a].removeEventListener("play",audioObjects[a].onPlayCB),audioObjects[a].removeEventListener("error",audioObjects[a].onErrorCB),audioObjects[a].removeEventListener("error",audioObjects[a].onStalledCB)},seekToAudio:function(e,o,i){var a=i[0],t=i[1];console.log("media::seekToAudio()"),audioObjects[a].currentTime=t,e(audioObjects[a].currentTime)},pausePlayingAudio:function(e,o,i){var a=i[0];console.log("media::pausePlayingAudio() - MEDIA_STATE -> MEDIA_PAUSED"),audioObjects[a].pause(),Media.onStatus(a,Media.MEDIA_STATE,Media.MEDIA_PAUSED)},getCurrentPositionAudio:function(e,o,i){var a=i[0];console.log("media::getCurrentPositionAudio()"),e(audioObjects[a].currentTime)},startRecordingAudio:function(e,o,i){function a(e){audioObjects[n].src=webkitURL.createObjectURL(e),console.log("media::startRecordingAudio() - stream CB")}function t(e){console.log("media::startRecordingAudio() - error CB:"+e.toString())}var n=i[0],d=i[1];console.log("media::startRecordingAudio() - id ="+n+", src ="+d),navigator.webkitGetUserMedia?(audioObjects[n]=new Audio,navigator.webkitGetUserMedia("audio",a,t)):console.log("webkitGetUserMedia not supported"),e()},stopRecordingAudio:function(e,o,i){var a=i[0];console.log("media::stopRecordingAudio() - id ="+a),audioObjects[a].pause(),e()},release:function(e,o,i){var a=i[0];window.clearTimeout(audioObjects[a].timer),console.log("media::release()")},setVolume:function(e,o,i){var a=i[0],t=i[1];console.log("media::setVolume()"),audioObjects[a].volume=t}},require("cordova/tizen/commandProxy").add("Media",module.exports);