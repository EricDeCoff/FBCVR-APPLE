var cordova=require("cordova"),Media=require("org.apache.cordova.media.Media"),MediaError=require("org.apache.cordova.media.MediaError"),recordedFile;module.exports={mediaCaptureMrg:null,create:function(e,a,i){var d=i[0],o=i[1],r=Media.get(d);Media.onStatus(d,Media.MEDIA_STATE,Media.MEDIA_STARTING),Media.prototype.node=null;var t=o.split(".").pop();if(null===r.node)if("mp3"===t||"wma"===t||"wav"===t||"cda"===t||"adx"===t||"wm"===t||"m3u"===t||"wmx"===t||"m4a"===t){r.node=new Audio(o),r.node.load();var n=function(){var e=r.node.duration;isNaN(e)&&(e=-1),Media.onStatus(d,Media.MEDIA_DURATION,e)};r.node.onloadedmetadata=n,n()}else a&&a({code:MediaError.MEDIA_ERR_ABORTED})},startPlayingAudio:function(e,a,i){var d=i[0],o=Media.get(d);o.node||module.exports.create(e,a,i),Media.onStatus(d,Media.MEDIA_STATE,Media.MEDIA_RUNNING),o.node.play()},stopPlayingAudio:function(e,a,i){var d=i[0];try{Media.get(d).node.pause(),Media.get(d).node.currentTime=0,Media.onStatus(d,Media.MEDIA_STATE,Media.MEDIA_STOPPED),e()}catch(o){a("Failed to stop: "+o)}},seekToAudio:function(e,a,i){var d=i[0],o=i[1];try{Media.get(d).node.currentTime=o/1e3,e()}catch(r){a("Failed to seek: "+r)}},pausePlayingAudio:function(e,a,i){var d=i[0],o=Media.get(d);try{o.node.pause(),Media.onStatus(d,Media.MEDIA_STATE,Media.MEDIA_PAUSED)}catch(r){a("Failed to pause: "+r)}},getCurrentPositionAudio:function(e,a,i){var d=i[0];try{var o=Media.get(d).node.currentTime;Media.onStatus(d,Media.MEDIA_POSITION,o),e(o)}catch(r){a(r)}},startRecordingAudio:function(e,a,i){var d=i[0],o=i[1],r=o.replace(/\//g,"\\"),t=r.substr(0,r.lastIndexOf("\\")),n=r.replace(t+"\\","");Media.prototype.mediaCaptureMgr=null;var u=Media.get(d),c=new Windows.Media.Capture.MediaCaptureInitializationSettings;c.streamingCaptureMode=Windows.Media.Capture.StreamingCaptureMode.audio,u.mediaCaptureMgr=new Windows.Media.Capture.MediaCapture,u.mediaCaptureMgr.addEventListener("failed",a),u.mediaCaptureMgr.initializeAsync(c).done(function(){u.mediaCaptureMgr.addEventListener("recordlimitationexceeded",a),u.mediaCaptureMgr.addEventListener("failed",a),Windows.Storage.ApplicationData.current.temporaryFolder.createFileAsync(n,Windows.Storage.CreationCollisionOption.replaceExisting).done(function(i){recordedFile=i;var d=null;switch(i.fileType){case".m4a":d=Windows.Media.MediaProperties.MediaEncodingProfile.createM4a(Windows.Media.MediaProperties.AudioEncodingQuality.auto);break;case".mp3":d=Windows.Media.MediaProperties.MediaEncodingProfile.createMp3(Windows.Media.MediaProperties.AudioEncodingQuality.auto);break;case".wma":d=Windows.Media.MediaProperties.MediaEncodingProfile.createWma(Windows.Media.MediaProperties.AudioEncodingQuality.auto);break;default:a("Invalid file type for record")}u.mediaCaptureMgr.startRecordToStorageFileAsync(d,i).done(e,a)},a)},a)},stopRecordingAudio:function(e,a,i){var d=i[0],o=Media.get(d),r=o.src.replace(/\//g,"\\"),t=r.substr(0,r.lastIndexOf("\\")),n=r.replace(t+"\\","");o.mediaCaptureMgr.stopRecordAsync().done(function(){t?Windows.Storage.StorageFolder.getFolderFromPathAsync(t).done(function(i){recordedFile.copyAsync(i,n,Windows.Storage.CreationCollisionOption.replaceExisting).done(e,a)},a):e()},a)},release:function(e,a,i){var d=i[0],o=Media.get(d);try{delete o.node}catch(r){a("Failed to release: "+r)}},setVolume:function(e,a,i){var d=i[0],o=i[1],r=Media.get(d);r.volume=o}},require("cordova/exec/proxy").add("Media",module.exports);