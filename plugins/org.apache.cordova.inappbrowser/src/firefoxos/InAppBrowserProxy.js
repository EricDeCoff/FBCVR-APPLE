var cordova=require("cordova"),channel=require("cordova/channel"),modulemapper=require("cordova/modulemapper"),origOpenFunc=modulemapper.getOriginalSymbol(window,"window.open"),browserWrap,IABExecs={close:function(e){browserWrap&&(browserWrap.parentNode.removeChild(browserWrap),browserWrap=null,"function"==typeof e&&e({type:"exit"}))},show:function(){console.error("[FirefoxOS] show not implemented")},open:function(e,r,o){function t(){browserWrap.style.width=window.innerWidth+"px",browserWrap.style.height=window.innerHeight+"px",browserWrap.style.zIndex="999999999",browserWrap.browser.style.height=window.innerHeight-60+"px",browserWrap.browser.style.width=browserWrap.style.width}function n(){var e=l.getCanGoBack();e.onsuccess=function(){this.result?u.classList.remove("disabled"):u.classList.add("disabled")};var r=l.getCanGoForward();r.onsuccess=function(){this.result?m.classList.remove("disabled"):m.classList.add("disabled")}}var i=o[0],s=o[1],d=o[2]||"location=yes",a={},c=d.split(",");if(c.forEach(function(e){var r=e.split("=");if("yes"==r[1])r[1]=!0;else if("no"==r[1])r[1]=!1;else{var o=parseInt(r[1]);isNaN(o)||(r[1]=o)}a[r[0]]=r[1]}),"_system"===s)origOpenFunc.apply(window,[i,"_blank"]);else if("_blank"===s){var l=document.createElement("iframe");l.setAttribute("mozbrowser",!0),l.setAttribute("remote",!0),l.setAttribute("src",i),browserWrap&&document.body.removeChild(browserWrap),browserWrap=document.createElement("div"),browserWrap.browser=l,browserWrap.classList.add("inAppBrowserWrap"),browserWrap.style.position="fixed",l.style.position="absolute",l.style.border=0,l.style.top="60px",l.style.left="0px",t();var p=document.createElement("menu");p.setAttribute("type","toolbar");var w=document.createElement("li"),u=document.createElement("li"),m=document.createElement("li");w.appendChild(document.createTextNode("Ã—")),u.appendChild(document.createTextNode("<")),m.appendChild(document.createTextNode(">")),w.classList.add("inAppBrowserClose"),u.classList.add("inAppBrowserBack"),m.classList.add("inAppBrowserForward"),l.addEventListener("mozbrowserloadend",n),w.addEventListener("click",function(){setTimeout(function(){IABExecs.close(e,r)},0)},!1),u.addEventListener("click",function(){l.goBack()},!1),m.addEventListener("click",function(){l.goForward()},!1),p.appendChild(u),p.appendChild(m),p.appendChild(w),browserWrap.appendChild(p),browserWrap.appendChild(l),document.body.appendChild(browserWrap),l.addEventListener("mozbrowserlocationchange",function(r){e({type:"loadstart",url:r.detail})},!1),l.addEventListener("mozbrowserloadend",function(){e({type:"loadstop"})},!1),l.addEventListener("mozbrowsererror",function(){e({type:"loaderror"})},!1),l.addEventListener("mozbrowserclose",function(){e({type:"exit"})},!1)}else window.location=i},injectScriptCode:function(){console.error("[FirefoxOS] injectScriptCode not implemented")},injectScriptFile:function(){console.error("[FirefoxOS] injectScriptFile not implemented")}};module.exports=IABExecs,require("cordova/exec/proxy").add("InAppBrowser",module.exports);