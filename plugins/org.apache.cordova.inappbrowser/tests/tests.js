var cordova=require("cordova"),isWindows="windows"==cordova.platformId;window.alert=window.alert||navigator.notification.alert,exports.defineManualTests=function(e,o){function t(e,o,t,n){function i(){a={loaderror:0,loadstart:0,loadstop:0,exit:0},d=""}function l(e){if(console.log("IAB event="+JSON.stringify(e)),a[e.type]++,"loadstart"==e.type&&(e.url==d&&alert("Unexpected: loadstart fired multiple times for the same URL."),d=e.url),("loadstop"==e.type||"loaderror"==e.type)&&(e.url!=d&&alert("Unexpected: "+e.type+" event.url != loadstart's event.url"),0===n&&1!==a.loadstart?("loaderror"!=e.type||0!==a.loadstart)&&alert("Unexpected: got multiple loadstart events. ("+a.loadstart+")"):n>0&&a.loadstart<n+1&&alert("Unexpected: should have got at least "+(n+1)+" loadstart events, but got "+a.loadstart),s=!0,n=0,i()),"exit"==e.type){var o=a.loadstop+a.loaderror;0!==o||s?o>1&&alert("Unexpected: got multiple loadstop/loaderror events."):alert("Unexpected: browser closed without a loadstop or loaderror.")}}n=n||0,console.log("Opening "+e);var a,d,s=!1;i();var r=window.open(e,o,t,{loaderror:l,loadstart:l,loadstop:l,exit:l});return r?r:void alert("window.open returned "+r)}function n(e,o,n){var i=t(e,"_blank","location=yes"),l=function(e){e&&0===e.length?alert("Results verified"):(console.log(e),alert("Got: "+typeof e+"\n"+JSON.stringify(e)))};o?i.addEventListener("loadstop",function(){i.insertCSS({file:o},n&&l)}):i.addEventListener("loadstop",function(){i.insertCSS({code:"#style-update-literal { \ndisplay: block !important; \n}"},n&&l)})}function i(e,o,n){var i=t(e,"_blank","location=yes");o?i.addEventListener("loadstop",function(){i.executeScript({file:o},n&&function(e){e&&0===e.length?alert("Results verified"):(console.log(e),alert("Got: "+typeof e+"\n"+JSON.stringify(e)))})}):i.addEventListener("loadstop",function(){var e='(function(){\n    var header = document.getElementById("header");\n    header.innerHTML = "Script literal successfully injected";\n    return "abc";\n})()';i.executeScript({code:e},n&&function(e){e&&1===e.length&&"abc"===e[0]?alert("Results verified"):(console.log(e),alert("Got: "+typeof e+"\n"+JSON.stringify(e)))})})}function l(e,o){var t=o?"hidden=yes":"";return(s=window.open(e,"random_string",t))?void(o&&s.addEventListener("loadstop",r)):void alert("window.open returned "+s)}function a(){s&&s.show()}function d(){s&&(s.removeEventListener("loadstop",r),s.close(),s=null)}var s=null,r=function(){alert("background window loaded ")},p='<h1>InAppBrowser</h1><div id="info">Make sure http://cordova.apache.org and http://google.co.uk and https://www.google.co.uk are white listed. </br>Make sure http://www.apple.com is not in the white list.</br>In iOS, starred <span style="vertical-align:super">*</span> tests will put the app in a state with no way to return. </br><h4>User-Agent: <span id="user-agent"> </span></hr></div>',c='<h1>Local URL</h1><div id="openLocal"></div>Expected result: opens successfully in CordovaWebView.<p/> <div id="openLocalSelf"></div>Expected result: opens successfully in CordovaWebView.<p/> <div id="openLocalSystem"></div>Expected result: fails to open<p/> <div id="openLocalBlank"></div>Expected result: opens successfully in InAppBrowser with locationBar at top.<p/> <div id="openLocalRandomNoLocation"></div>Expected result: opens successfully in InAppBrowser without locationBar.<p/> <div id="openLocalRandomToolBarBottom"></div>Expected result: opens successfully in InAppBrowser with locationBar. On iOS the toolbar is at the bottom.<p/> <div id="openLocalRandomToolBarTop"></div>Expected result: opens successfully in InAppBrowser with locationBar. On iOS the toolbar is at the top.<p/><div id="openLocalRandomToolBarTopNoLocation"></div>Expected result: open successfully in InAppBrowser with no locationBar. On iOS the toolbar is at the top.',u='<h1>White Listed URL</h1><div id="openWhiteListed"></div>Expected result: open successfully in CordovaWebView to cordova.apache.org<p/> <div id="openWhiteListedSelf"></div>Expected result: open successfully in CordovaWebView to cordova.apache.org<p/> <div id="openWhiteListedSystem"></div>Expected result: open successfully in system browser to cordova.apache.org<p/> <div id="openWhiteListedBlank"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org<p/> <div id="openWhiteListedRandom"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org<p/> <div id="openWhiteListedRandomNoLocation"></div>Expected result: open successfully in InAppBrowser to cordova.apache.org with no location bar.',h='<h1>Non White Listed URL</h1><div id="openNonWhiteListed"></div>Expected result: open successfully in InAppBrowser to apple.com (_self enforces whitelist).<p/> <div id="openNonWhiteListedSelf"></div>Expected result: open successfully in InAppBrowser to apple.com (_self enforces whitelist).<p/> <div id="openNonWhiteListedSystem"></div>Expected result: open successfully in system browser to apple.com.<p/> <div id="openNonWhiteListedBlank"></div>Expected result: open successfully in InAppBrowser to apple.com.<p/> <div id="openNonWhiteListedRandom"></div>Expected result: open successfully in InAppBrowser to apple.com.<p/> <div id="openNonWhiteListedRandomNoLocation"></div>Expected result: open successfully in InAppBrowser to apple.com without locationBar.',w='<h1>Page with redirect</h1><div id="openRedirect301"></div>Expected result: should 301 and open successfully in InAppBrowser to https://www.google.co.uk.<p/> <div id="openRedirect302"></div>Expected result: should 302 and open successfully in InAppBrowser to www.zhihu.com/answer/16714076.',f='<h1>PDF URL</h1><div id="openPDF"></div>Expected result: InAppBrowser opens. PDF should render on iOS.<p/> <div id="openPDFBlank"></div>Expected result: InAppBrowser opens. PDF should render on iOS.',v='<h1>Invalid URL</h1><div id="openInvalidScheme"></div>Expected result: fail to load in InAppBrowser.<p/> <div id="openInvalidHost"></div>Expected result: fail to load in InAppBrowser.<p/> <div id="openInvalidMissing"></div>Expected result: fail to load in InAppBrowser (404).',g='<h1>CSS / JS Injection</h1><div id="openOriginalDocument"></div>Expected result: open successfully in InAppBrowser without text "Style updated from..."<p/> <div id="openCSSInjection"></div>Expected result: open successfully in InAppBrowser with "Style updated from file".<p/> <div id="openCSSInjectionCallback"></div>Expected result: open successfully in InAppBrowser with "Style updated from file", and alert dialog with text "Results verified".<p/> <div id="openCSSLiteralInjection"></div>Expected result: open successfully in InAppBrowser with "Style updated from literal".<p/> <div id="openCSSLiteralInjectionCallback"></div>Expected result: open successfully in InAppBrowser with "Style updated from literal", and alert dialog with text "Results verified".<p/> <div id="openScriptInjection"></div>Expected result: open successfully in InAppBrowser with text "Script file successfully injected".<p/> <div id="openScriptInjectionCallback"></div>Expected result: open successfully in InAppBrowser with text "Script file successfully injected" and alert dialog with the text "Results verified".<p/> <div id="openScriptLiteralInjection"></div>Expected result: open successfully in InAppBrowser with the text "Script literal successfully injected" .<p/> <div id="openScriptLiteralInjectionCallback"></div>Expected result: open successfully in InAppBrowser with the text "Script literal successfully injected" and alert dialog with the text "Results verified".',m='<h1>Open Hidden </h1><div id="openHidden"></div>Expected result: no additional browser window. Alert appears with the text "background window loaded".<p/> <div id="showHidden"></div>Expected result: after first clicking on previous test "create hidden", open successfully in InAppBrowser to https://www.google.co.uk.<p/> <div id="closeHidden"></div>Expected result: no output. But click on "show hidden" again and nothing should be shown.<p/> <div id="openHiddenShow"></div>Expected result: open successfully in InAppBrowser to https://www.google.co.uk',S='<h1>Clearing Cache</h1><div id="openClearCache"></div>Expected result: ?<p/> <div id="openClearSessionCache"></div>Expected result: ?',y='<h1>Video tag</h1><div id="openRemoteVideo"></div>Expected result: open successfully in InAppBrowser with an embedded video that works after clicking the "play" button.',L='<h1>Local with anchor tag</h1><div id="openAnchor1"></div>Expected result: open successfully in InAppBrowser to the local page, scrolled to the top as normal.<p/> <div id="openAnchor2"></div>Expected result: open successfully in InAppBrowser to the local page, scrolled to the beginning of the tall div with border.';window.MSApp&&window.MSApp.execUnsafeLocalFunction?MSApp.execUnsafeLocalFunction(function(){e.innerHTML=p+c+u+h+w+f+v+g+m+S+y+L}):e.innerHTML=p+c+u+h+w+f+v+g+m+S+y+L,document.getElementById("user-agent").textContent=navigator.userAgent;var I="iab-resources/",x=I+"local.html",b=I+"local.pdf",B=I+"inject.html",k=isWindows?I+"inject.js":"inject.js",E=isWindows?I+"inject.css":"inject.css",A=I+"video.html";o("target=Default",function(){t(x)},"openLocal"),o("target=_self",function(){t(x,"_self")},"openLocalSelf"),o("target=_system",function(){t(x,"_system")},"openLocalSystem"),o("target=_blank",function(){t(x,"_blank")},"openLocalBlank"),o("target=Random, location=no, disallowoverscroll=yes",function(){t(x,"random_string","location=no, disallowoverscroll=yes")},"openLocalRandomNoLocation"),o("target=Random, toolbarposition=bottom",function(){t(x,"random_string","toolbarposition=bottom")},"openLocalRandomToolBarBottom"),o("target=Random, toolbarposition=top",function(){t(x,"random_string","toolbarposition=top")},"openLocalRandomToolBarTop"),o("target=Random, toolbarposition=top, location=no",function(){t(x,"random_string","toolbarposition=top,location=no")},"openLocalRandomToolBarTopNoLocation"),o("* target=Default",function(){t("http://cordova.apache.org")},"openWhiteListed"),o("* target=_self",function(){t("http://cordova.apache.org","_self")},"openWhiteListedSelf"),o("target=_system",function(){t("http://cordova.apache.org","_system")},"openWhiteListedSystem"),o("target=_blank",function(){t("http://cordova.apache.org","_blank")},"openWhiteListedBlank"),o("target=Random",function(){t("http://cordova.apache.org","random_string")},"openWhiteListedRandom"),o("* target=Random, no location bar",function(){t("http://cordova.apache.org","random_string","location=no")},"openWhiteListedRandomNoLocation"),o("target=Default",function(){t("http://www.apple.com")},"openNonWhiteListed"),o("target=_self",function(){t("http://www.apple.com","_self")},"openNonWhiteListedSelf"),o("target=_system",function(){t("http://www.apple.com","_system")},"openNonWhiteListedSystem"),o("target=_blank",function(){t("http://www.apple.com","_blank")},"openNonWhiteListedBlank"),o("target=Random",function(){t("http://www.apple.com","random_string")},"openNonWhiteListedRandom"),o("* target=Random, no location bar",function(){t("http://www.apple.com","random_string","location=no")},"openNonWhiteListedRandomNoLocation"),o("http://google.co.uk",function(){t("http://google.co.uk","random_string","",1)},"openRedirect301"),o("http://goo.gl/pUFqg",function(){t("http://goo.gl/pUFqg","random_string","",2)},"openRedirect302"),o("Remote URL",function(){t("http://www.stluciadance.com/prospectus_file/sample.pdf")},"openPDF"),o("Local URL",function(){t(b,"_blank")},"openPDFBlank"),o("Invalid Scheme",function(){t("x-ttp://www.invalid.com/","_blank")},"openInvalidScheme"),o("Invalid Host",function(){t("http://www.inv;alid.com/","_blank")},"openInvalidHost"),o("Missing Local File",function(){t("nonexistent.html","_blank")},"openInvalidMissing"),o("Original Document",function(){t(B,"_blank")},"openOriginalDocument"),o("CSS File Injection",function(){n(B,E)},"openCSSInjection"),o("CSS File Injection (callback)",function(){n(B,E,!0)},"openCSSInjectionCallback"),o("CSS Literal Injection",function(){n(B)},"openCSSLiteralInjection"),o("CSS Literal Injection (callback)",function(){n(B,null,!0)},"openCSSLiteralInjectionCallback"),o("Script File Injection",function(){i(B,k)},"openScriptInjection"),o("Script File Injection (callback)",function(){i(B,k,!0)},"openScriptInjectionCallback"),o("Script Literal Injection",function(){i(B)},"openScriptLiteralInjection"),o("Script Literal Injection (callback)",function(){i(B,null,!0)},"openScriptLiteralInjectionCallback"),o("Create Hidden",function(){l("https://www.google.co.uk",!0)},"openHidden"),o("Show Hidden",function(){a()},"showHidden"),o("Close Hidden",function(){d()},"closeHidden"),o("google.co.uk Not Hidden",function(){l("https://www.google.co.uk",!1)},"openHiddenShow"),o("Clear Browser Cache",function(){t("https://www.google.co.uk","_blank","clearcache=yes")},"openClearCache"),o("Clear Session Cache",function(){t("https://www.google.co.uk","_blank","clearsessioncache=yes")},"openClearSessionCache"),o("Remote Video",function(){t(A,"_blank")},"openRemoteVideo"),o("Anchor1",function(){t(x+"#bogusanchor","_blank")},"openAnchor1"),o("Anchor2",function(){t(x+"#anchor2","_blank")},"openAnchor2")};