exports.defineAutoTests=function(){var e="windows"==cordova.platformId||-1!==navigator.appVersion.indexOf("MSAppHost/1.0");describe("File API",function(){var t,r,o,n={1:"NOT_FOUND_ERR",2:"SECURITY_ERR",3:"ABORT_ERR",4:"NOT_READABLE_ERR",5:"ENCODING_ERR",6:"NO_MODIFICATION_ALLOWED_ERR",7:"INVALID_STATE_ERR",8:"SYNTAX_ERR",9:"INVALID_MODIFICATION_ERR",10:"QUOTA_EXCEEDED_ERR",11:"TYPE_MISMATCH_ERR",12:"PATH_EXISTS_ERR"};beforeEach(function(e){jasmine.Expectation.addMatchers({toBeFileError:function(){return{compare:function(e,t){var i=e.code==t;return{pass:i,message:"Expected FileError with code "+n[e.code]+" ("+e.code+") to be "+n[t]+"("+t+")"}}}},toCanonicallyMatch:function(){return{compare:function(e,t){var i=t.split("/").join("").split("\\").join(""),r=e.split("/").join("").split("\\").join(""),o=i==r;return{pass:o,message:"Expected paths to match : "+t+" should be "+e}}}},toFailWithMessage:function(){return{compare:function(e,t){var i=!1;return{pass:i,message:t}}}}});var i=function(e){console.log("[ERROR] Problem setting up root filesystem for test running! Error to follow."),console.log(JSON.stringify(e))};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){t=n.root,o=t,window.requestFileSystem(LocalFileSystem.TEMPORARY,0,function(t){r=t.root,e()},i)},i)});var l=function(e,i,r){window.resolveLocalFileSystemURL(t.toURL()+"/"+e,function(e){e.isDirectory===!0?e.removeRecursively(i,r):e.remove(i,r)},i)},c=function(e,i){t.getFile(e,null,function(e){e.remove(i,function(){console.log("[ERROR] deleteFile cleanup method invoked fail callback.")})},i)},a=function(e,i,r){l(e,function(){t.getFile(e,{create:!0},i,r)},r)},f=function(e,i,r){l(e,function(){t.getDirectory(e,{create:!0},i,r)},r)},u=function(e,t,i){var r="undefined"==typeof t?"Unexpected error callback":t;expect(!0).toFailWithMessage(r+"\n"+JSON.stringify(i)),e()},d=function(e,t){var i="undefined"==typeof t?"Unexpected success callback":t;expect(!0).toFailWithMessage(i),e()},s=function(e,t){return"/"!==e.charAt(e.length-1)&&"/"!==t.charAt(0)?e+"/"+t:"/"===e.charAt(e.length-1)&&"/"===t.charAt(0)?e+exension.substring(1):e+t};describe("FileError object",function(){it("file.spec.1 should define FileError constants",function(){expect(FileError.NOT_FOUND_ERR).toBe(1),expect(FileError.SECURITY_ERR).toBe(2),expect(FileError.ABORT_ERR).toBe(3),expect(FileError.NOT_READABLE_ERR).toBe(4),expect(FileError.ENCODING_ERR).toBe(5),expect(FileError.NO_MODIFICATION_ALLOWED_ERR).toBe(6),expect(FileError.INVALID_STATE_ERR).toBe(7),expect(FileError.SYNTAX_ERR).toBe(8),expect(FileError.INVALID_MODIFICATION_ERR).toBe(9),expect(FileError.QUOTA_EXCEEDED_ERR).toBe(10),expect(FileError.TYPE_MISMATCH_ERR).toBe(11),expect(FileError.PATH_EXISTS_ERR).toBe(12)})}),describe("LocalFileSystem",function(){it("file.spec.2 should define LocalFileSystem constants",function(){expect(LocalFileSystem.TEMPORARY).toBe(0),expect(LocalFileSystem.PERSISTENT).toBe(1)}),describe("window.requestFileSystem",function(){it("file.spec.3 should be defined",function(){expect(window.requestFileSystem).toBeDefined()}),it("file.spec.4 should be able to retrieve a PERSISTENT file system",function(e){var t=function(t){expect(t).toBeDefined(),expect(t.name).toBeDefined(),expect(t.name).toBe("persistent"),expect(t.root).toBeDefined(),expect(t.root.filesystem).toBeDefined(),expect(t.root.toURL()).not.toMatch(/^cdvfile:/),expect(t.root.toURL()).toMatch(/\/$/),e()};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,t,u.bind(null,e,"window.requestFileSystem - Error retrieving PERSISTENT file system"))}),it("file.spec.5 should be able to retrieve a TEMPORARY file system",function(e){var t=function(t){expect(t).toBeDefined(),expect(t.name).toBeDefined(),expect(t.name).toBe("temporary"),expect(t.root).toBeDefined(),expect(t.root.filesystem).toBeDefined(),expect(t.root.filesystem).toBe(t),e()};window.requestFileSystem(LocalFileSystem.TEMPORARY,0,t,u.bind(null,e,"window.requestFileSystem - Error retrieving TEMPORARY file system"))}),it("file.spec.6 should error if you request a file system that is too large",function(e){var t=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.QUOTA_EXCEEDED_ERR),e()};window.requestFileSystem(LocalFileSystem.TEMPORARY,1e15,u.bind(null,e,"window.requestFileSystem - Error retrieving TEMPORARY file system"),t)}),it("file.spec.7 should error out if you request a file system that does not exist",function(e){var t=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.SYNTAX_ERR),e()};window.requestFileSystem(-1,0,d.bind(null,e,"window.requestFileSystem"),t)})}),describe("window.resolveLocalFileSystemURL",function(){it("file.spec.8 should be defined",function(){expect(window.resolveLocalFileSystemURL).toBeDefined()}),it("file.spec.9 should resolve a valid file name",function(e){var t="file.spec.9",i=function(i){expect(i).toBeDefined(),expect(i.name).toCanonicallyMatch(t),expect(i.toURL()).not.toMatch(/^cdvfile:/,"should not use cdvfile URL"),expect(i.toURL()).not.toMatch(/\/$/,"URL should not end with a slash"),l(t),e()};a(t,function(t){window.resolveLocalFileSystemURL(t.toURL(),i,u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving file URL: "+t.toURL()))},u.bind(null,e,"createFile - Error creating file: "+t),u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.9.5 should resolve a directory",function(e){function t(t){window.resolveLocalFileSystemURL(t.toURL(),r,u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving directory URL: "+t.toURL()))}var i="file.spec.9.5",r=function(t){expect(t).toBeDefined(),expect(t.name).toCanonicallyMatch(i),expect(t.toURL()).not.toMatch(/^cdvfile:/,"should not use cdvfile URL"),expect(t.toURL()).toMatch(/\/$/,"URL end with a slash"),l(i),e()};f(i,t,u.bind(null,e,"createDirectory - Error creating directory: "+i),u.bind(null,e,"createDirectory - Error creating directory: "+i))}),it("file.spec.10 resolve valid file name with parameters",function(e){var t="resolve.file.uri.params",i=function(i){expect(i).toBeDefined(),"cdvfile://"===i.toURL().toLowerCase().substring(0,10)&&expect(i.fullPath).toBe("/"+t+"?1234567890"),expect(i.name).toBe(t),l(t),e()};a(t,function(t){window.resolveLocalFileSystemURL(t.toURL()+"?1234567890",i,u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving file URI: "+t.toURL()))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.11 should error (NOT_FOUND_ERR) when resolving (non-existent) invalid file name",function(e){var i="windowsphone"===cordova.platformId?t.toURL()+"/this.is.not.a.valid.file.txt":s(t.toURL(),"this.is.not.a.valid.file.txt");fail=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()},window.resolveLocalFileSystemURL(i,d.bind(null,e,"window.resolveLocalFileSystemURL - Error unexpected callback resolving file URI: "+i),fail)}),it("file.spec.12 should error (ENCODING_ERR) when resolving invalid URI with leading /",function(e){var t="/this.is.not.a.valid.url",i=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.ENCODING_ERR),e()};window.resolveLocalFileSystemURL(t,d.bind(null,e,"window.resolveLocalFileSystemURL - Error unexpected callback resolving file URI: "+t),i)})})}),describe("Metadata interface",function(){it("file.spec.13 should exist and have the right properties",function(){var e=new Metadata;expect(e).toBeDefined(),expect(e.modificationTime).toBeDefined()})}),describe("Flags interface",function(){it("file.spec.14 should exist and have the right properties",function(){var e=new Flags(!1,!0);expect(e).toBeDefined(),expect(e.create).toBeDefined(),expect(e.create).toBe(!1),expect(e.exclusive).toBeDefined(),expect(e.exclusive).toBe(!0)})}),describe("FileSystem interface",function(){it("file.spec.15 should have a root that is a DirectoryEntry",function(e){var i=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.name).toBeDefined(),expect(t.fullPath).toBeDefined(),expect(t.getMetadata).toBeDefined(),expect(t.moveTo).toBeDefined(),expect(t.copyTo).toBeDefined(),expect(t.toURL).toBeDefined(),expect(t.remove).toBeDefined(),expect(t.getParent).toBeDefined(),expect(t.createReader).toBeDefined(),expect(t.getFile).toBeDefined(),expect(t.getDirectory).toBeDefined(),expect(t.removeRecursively).toBeDefined(),e()};window.resolveLocalFileSystemURL(t.toURL(),i,u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving file URI: "+t.toURL()))})}),describe("DirectoryEntry",function(){it("file.spec.16 getFile: get Entry for file that does not exist",function(e){var i="de.no.file",r=(s(t.fullPath,i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()});t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Error unexpected callback, file should not exists: "+i),r)}),it("file.spec.17 getFile: create new file",function(e){var i="de.create.file",r=s(t.fullPath,i),o=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,null),e()};t.getFile(i,{create:!0},o,d.bind(null,e,"root.getFile - Error unexpected callback, file should not exists: "+i))}),it("file.spec.18 getFile: create new file (exclusive)",function(e){var i="de.create.exclusive.file",r=s(t.fullPath,i),o=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toBe(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,null),e()};t.getFile(i,{create:!0,exclusive:!0},o,u.bind(null,e,"root.getFile - Error creating file: "+i))}),it("file.spec.19 getFile: create file that already exists",function(e){var i="de.create.existing.file",r=s(t.fullPath,i),o=function(){t.getFile(i,{create:!0},n,u.bind(null,e,"root.getFile - Error creating file: "+i))},n=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,fail),e()};t.getFile(i,{create:!0},o,fail)}),it("file.spec.20 getFile: create file that already exists (exclusive)",function(e){var i,r="de.create.exclusive.existing.file",o=(s(t.fullPath,r),function(o){i=o,t.getFile(r,{create:!0,exclusive:!0},d.bind(null,e,"root.getFile - getFile function - Error unexpected callback, file should exists: "+r),n)}),n=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.PATH_EXISTS_ERR),i.remove(null,null),e()};t.getFile(r,{create:!0},o,u.bind(null,e,"root.getFile - Error creating file: "+r))}),it("file.spec.21 DirectoryEntry.getFile: get Entry for existing file",function(e){var i="de.get.file",r=s(t.fullPath,i),o=function(o){expect(o).toBeDefined(),expect(o.isFile).toBe(!0),expect(o.isDirectory).toBe(!1),expect(o.name).toCanonicallyMatch(i),expect(o.fullPath).toCanonicallyMatch(r),expect(o.filesystem).toBeDefined(),expect(o.filesystem).toBe(t.filesystem),o.remove(null,null),e()},n=function(){t.getFile(i,{create:!1},o,u.bind(null,e,"root.getFile - Error getting file entry: "+i))};t.getFile(i,{create:!0},n,u.bind(null,e,"root.getFile - Error creating file: "+i))}),it("file.spec.22 DirectoryEntry.getFile: get FileEntry for invalid path",function(e){var i="de:invalid:path",r=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.ENCODING_ERR),e()};t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Error unexpected callback, file should not exists: "+i),r)}),it("file.spec.23 DirectoryEntry.getDirectory: get Entry for directory that does not exist",function(e){var i="de.no.dir",r=(s(t.fullPath,i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()});t.getDirectory(i,{create:!1},d.bind(null,e,"root.getDirectory - Error unexpected callback, directory should not exists: "+i),r)}),it("file.spec.24 DirectoryEntry.getDirectory: create new dir with space then resolveLocalFileSystemURL",function(e){var i="de create dir",r=(s(t.fullPath,encodeURIComponent(i)),function(i){expect(i.filesystem).toBeDefined(),expect(i.filesystem).toBe(t.filesystem);var r=i.toURL();window.resolveLocalFileSystemURL(r,o,u.bind(null,e,"window.resolveLocalFileSystemURL - getDir function - Error resolving directory: "+r))}),o=function(r){expect(r).toBeDefined(),expect(r.isFile).toBe(!1),expect(r.isDirectory).toBe(!0),expect(r.name).toCanonicallyMatch(i),expect(r.fullPath).toCanonicallyMatch(s(t.fullPath,i)),r.remove(null,null),e()};t.getDirectory(i,{create:!0},r,u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),xit("file.spec.25 DirectoryEntry.getDirectory: create new dir with space resolveLocalFileSystemURL with encoded URI",function(e){var i="de create dir2",r=s(t.fullPath,i),o=function(t){var i=t.toURL();window.resolveLocalFileSystemURL(encodeURI(i),n,u.bind(null,e,"window.resolveLocalFileSystemURL - getDir function - Error resolving directory: "+i))},n=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,null),e()};t.getDirectory(i,{create:!0},o,u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.26 DirectoryEntry.getDirectory: create new directory",function(e){var i="de.create.dir",r=s(t.fullPath,i),o=function(o){expect(o).toBeDefined(),expect(o.isFile).toBe(!1),expect(o.isDirectory).toBe(!0),expect(o.name).toCanonicallyMatch(i),expect(o.fullPath).toCanonicallyMatch(r),expect(o.filesystem).toBeDefined(),expect(o.filesystem).toBe(t.filesystem),o.remove(null,null),e()};t.getDirectory(i,{create:!0},o,u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.27 DirectoryEntry.getDirectory: create new directory (exclusive)",function(e){var i="de.create.exclusive.dir",r=s(t.fullPath,i),o=function(o){expect(o).toBeDefined(),expect(o.isFile).toBe(!1),expect(o.isDirectory).toBe(!0),expect(o.name).toCanonicallyMatch(i),expect(o.fullPath).toCanonicallyMatch(r),expect(o.filesystem).toBeDefined(),expect(o.filesystem).toBe(t.filesystem),o.remove(null,null),e()};t.getDirectory(i,{create:!0,exclusive:!0},o,u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.28 DirectoryEntry.getDirectory: create directory that already exists",function(e){var i="de.create.existing.dir",r=s(t.fullPath,i),o=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,null),e()};t.getDirectory(i,{create:!0},function(){t.getDirectory(i,{create:!0},o,u.bind(null,e,"root.getDirectory - Error creating existent second directory : "+i))},u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.29 DirectoryEntry.getDirectory: create directory that already exists (exclusive)",function(e){var i,r="de.create.exclusive.existing.dir",o=(s(t.fullPath,r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.PATH_EXISTS_ERR),i.remove(null,null),e()});t.getDirectory(r,{create:!0},function(n){i=n,t.getDirectory(r,{create:!0,exclusive:!0},u.bind(null,e,"root.getDirectory - Unexpected success callback, second directory should not be created : "+r),o)},u.bind(null,e,"root.getDirectory - Error creating directory : "+r))}),it("file.spec.30 DirectoryEntry.getDirectory: get Entry for existing directory",function(e){var i="de.get.dir",r=s(t.fullPath,i),o=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),t.remove(null,null),e()};t.getDirectory(i,{create:!0},function(){t.getDirectory(i,{create:!1},o,u.bind(null,e,"root.getDirectory - Error getting directory entry : "+i))},u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.31 DirectoryEntry.getDirectory: get DirectoryEntry for invalid path",function(e){var i="de:invalid:path",r=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.ENCODING_ERR),e()};t.getDirectory(i,{create:!1},d.bind(null,e,"root.getDirectory - Unexpected success callback, directory should not exists: "+i),r)}),it("file.spec.32 DirectoryEntry.getDirectory: get DirectoryEntry for existing file",function(e){var i,r="de.existing.file",o=(s(t.fullPath,r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.TYPE_MISMATCH_ERR),i.remove(null,null),e()});t.getFile(r,{create:!0},function(n){i=n,t.getDirectory(r,{create:!1},d.bind(null,e,"root.getDirectory - Unexpected success callback, directory should not exists: "+r),o)},u.bind(null,e,"root.getFile - Error creating file : "+r))}),it("file.spec.33 DirectoryEntry.getFile: get FileEntry for existing directory",function(e){var i,r="de.existing.dir",o=(s(t.fullPath,r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.TYPE_MISMATCH_ERR),i.remove(null,null),e()});t.getDirectory(r,{create:!0},function(n){i=n,t.getFile(r,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, file should not exists: "+r),o)},u.bind(null,e,"root.getDirectory - Error creating directory : "+r))}),it("file.spec.34 DirectoryEntry.removeRecursively on directory",function(e){var i="de.removeRecursively",r="dir",o=s(t.fullPath,i),n=(s(o,r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()});t.getDirectory(i,{create:!0},function(o){o.getDirectory(r,{create:!0},function(){o.removeRecursively(function(){t.getDirectory(i,{create:!1},d.bind(null,e,"root.getDirectory - Unexpected success callback, directory should not exists: "+i),n)},u.bind(null,e,"entry.removeRecursively - Error removing directory recursively : "+i))},u.bind(null,e,"root.getDirectory - Error creating directory : "+r))},u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.35 createReader: create reader on existing directory",function(){var e=t.createReader();expect(e).toBeDefined(),expect(typeof e.readEntries).toBe("function")}),it("file.spec.36 removeRecursively on root file system",function(e){var i=function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR),e()};t.removeRecursively(d.bind(null,e,"root.removeRecursively - Unexpected success callback, root cannot be removed"),i)})}),describe("DirectoryReader interface",function(){describe("readEntries",function(){it("file.spec.37 should read contents of existing directory",function(e){var i,r=function(t){expect(t).toBeDefined(),expect(t instanceof Array).toBe(!0),e()};i=t.createReader(),i.readEntries(r,u.bind(null,e,"reader.readEntries - Error reading entries"))}),it("file.spec.37.1 should read contents of existing directory",function(e){var i="readEntries.dir",r="readeEntries.file";t.getDirectory(i,{create:!0},function(t){t.getFile(r,{create:!0},function(r){var o=t.createReader();o.readEntries(function(i){expect(i).toBeDefined(),expect(i instanceof Array).toBe(!0),expect(i.length).toBe(1),expect(i[0].fullPath).toCanonicallyMatch(r.fullPath),expect(i[0].filesystem).not.toBe(null),expect(i[0].filesystem instanceof FileSystem).toBe(!0),t.removeRecursively(null,null),e()},u.bind(null,e,"reader.readEntries - Error reading entries from directory: "+i))},u.bind(null,e,"directory.getFile - Error creating file : "+r))},u.bind(null,e,"root.getDirectory - Error creating directory : "+i))}),it("file.spec.109 should return an empty entry list on the second call",function(e){var i,r="test109.txt";t.getFile(r,{create:!0},function(r){i=t.createReader(),i.readEntries(function(t){expect(t).toBeDefined(),expect(t instanceof Array).toBe(!0),expect(t.length).not.toBe(0),i.readEntries(function(t){expect(t).toBeDefined(),expect(t instanceof Array).toBe(!0),expect(t.length).toBe(0),r.remove(),e()},u.bind(null,e,"reader.readEntries - Error during SECOND reading of entries from [root] directory"))},u.bind(null,e,"reader.readEntries - Error during FIRST reading of entries from [root] directory"))},u.bind(null,e,"root.getFile - Error creating file : "+r))})}),it("file.spec.38 should read contents of directory that has been removed",function(e){{var i="de.createReader.notfound";s(t.fullPath,i)}t.getDirectory(i,{create:!0},function(r){r.removeRecursively(function(){var o=r.createReader();o.readEntries(d.bind(null,e,"reader.readEntries - Unexpected success callback, it should not read entries from deleted dir: "+i),function(r){expect(r).toBeDefined(),expect(r).toBeFileError(FileError.NOT_FOUND_ERR),t.getDirectory(i,{create:!1},d.bind(null,e,"root.getDirectory - Unexpected success callback, it should not get deleted directory: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()})})},u.bind(null,e,"directory.removeRecursively - Error removing directory recursively : "+i))},u.bind(null,e,"root.getDirectory - Error creating directory : "+i))})}),describe("File",function(){it("file.spec.39 constructor should be defined",function(){expect(File).toBeDefined(),expect(typeof File).toBe("function")}),it("file.spec.40 should be define File attributes",function(){var e=new File;expect(e.name).toBeDefined(),expect(e.type).toBeDefined(),expect(e.lastModifiedDate).toBeDefined(),expect(e.size).toBeDefined()})}),describe("FileEntry",function(){it("file.spec.41 should be define FileEntry methods",function(e){var i="fe.methods",r=function(t){expect(t).toBeDefined(),expect(typeof t.createWriter).toBe("function"),expect(typeof t.file).toBe("function"),t.remove(null,null),e()};t.getFile(i,{create:!0},r,u.bind(null,e,"root.getFile - Error creating file : "+i))}),it("file.spec.42 createWriter should return a FileWriter object",function(e){var i,r="fe.createWriter",o=function(t){expect(t).toBeDefined(),expect(t instanceof FileWriter).toBe(!0),i.remove(null,null),e()};t.getFile(r,{create:!0},function(t){i=t,t.createWriter(o,u.bind(null,e,"fileEntry.createWriter - Error creating Writer from entry"))},u.bind(null,e,"root.getFile - Error creating file : "+r))}),it("file.spec.43 file should return a File object",function(e){var i,r="fe.file",o=function(t){expect(t).toBeDefined(),expect(t instanceof File).toBe(!0),i.remove(null,null),e()};t.getFile(r,{create:!0},function(t){i=t,t.file(o,u.bind(null,e,"fileEntry.file - Error reading file using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error creating file : "+r))}),it("file.spec.44 file: on File that has been removed",function(e){var i="fe.no.file";t.getFile(i,{create:!0},function(t){t.remove(function(){t.file(d.bind(null,e,"fileEntry.file - Unexpected success callback, file it should not be created from removed entry"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()})},u.bind(null,e,"fileEntry.remove - Error removing entry : "+i))},u.bind(null,e,"root.getFile - Error creating file : "+i))})}),describe("Entry",function(){it("file.spec.45 Entry object",function(e){var i="entry",r=s(t.fullPath,i),o=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toCanonicallyMatch(i),expect(t.fullPath).toCanonicallyMatch(r),expect(typeof t.getMetadata).toBe("function"),expect(typeof t.setMetadata).toBe("function"),expect(typeof t.moveTo).toBe("function"),expect(typeof t.copyTo).toBe("function"),expect(typeof t.toURL).toBe("function"),expect(typeof t.remove).toBe("function"),expect(typeof t.getParent).toBe("function"),expect(typeof t.createWriter).toBe("function"),expect(typeof t.file).toBe("function"),l(i),e()};a(i,o,u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.46 Entry.getMetadata on file",function(e){var t="entry.metadata.file";a(t,function(i){i.getMetadata(function(i){expect(i).toBeDefined(),expect(i.modificationTime instanceof Date).toBe(!0),expect(typeof i.size).toBe("number"),l(t),e()},u.bind(null,e,"entry.getMetadata - Error getting metadata from entry : "+t))},u.bind(null,e,"createFile - Error creating file : "+t))}),it("file.spec.47 Entry.getMetadata on directory",function(e){var t="entry.metadata.dir";f(t,function(i){i.getMetadata(function(i){expect(i).toBeDefined(),expect(i.modificationTime instanceof Date).toBe(!0),expect(typeof i.size).toBe("number"),expect(i.size).toBe(0),l(t),e()},u.bind(null,e,"entry.getMetadata - Error getting metadata from entry : "+t))},u.bind(null,e,"createDirectory - Error creating directory : "+t))}),it("file.spec.48 Entry.getParent on file in root file system",function(e){var i="entry.parent.file",r=t.fullPath;a(i,function(t){t.getParent(function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(r),l(i),e()},u.bind(null,e,"entry.getParent - Error getting parent directory of file : "+i))},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.49 Entry.getParent on directory in root file system",function(e){var i="entry.parent.dir",r=t.fullPath;f(i,function(t){t.getParent(function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(r),l(i),e()},u.bind(null,e,"entry.getParent - Error getting parent directory of directory : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.50 Entry.getParent on root file system",function(e){var i=t.fullPath,r=function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(i),e()};t.getParent(r,u.bind(null,e,"root.getParent - Error getting parent directory of root"))}),it("file.spec.51 Entry.toURL on file",function(e){var i="entry.uri.file",r=t.fullPath,o=function(t){var o=t.toURL();expect(o).toBeDefined(),expect(o.indexOf(r)).not.toBe(-1),l(i),e()};a(i,o,u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.52 Entry.toURL on directory",function(e){var i="num 1",r="num 2",o=t.fullPath;f(i,function(t){t.getDirectory(r,{create:!0},function(t){var r=t.toURL();expect(r).toBeDefined(),expect(r).toContain("/num%201/num%202/"),expect(r.indexOf(o)).not.toBe(-1),l(i),e()},u.bind(null,e,"entry.getDirectory - Error creating directory : "+r))},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.53 Entry.remove on file",function(e){var i="entr .rm.file";a(i,function(r){expect(r).toBeDefined(),r.remove(function(){t.getFile(i,null,d.bind(null,e,"root.getFile - Unexpected success callback, it should not get deleted file : "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(i),e()})},u.bind(null,e,"entry.remove - Error removing entry : "+i))},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.54 remove on empty directory",function(e){var i="entry.rm.dir";f(i,function(r){expect(r).toBeDefined(),r.remove(function(){t.getDirectory(i,null,d.bind(null,e,"root.getDirectory - Unexpected success callback, it should not get deleted directory : "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(i),e()})},u.bind(null,e,"entry.remove - Error removing entry : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.55 remove on non-empty directory",function(e){var i="ent y.rm.dir.not.empty",r="re ove.txt",o=s(t.fullPath,i);f(i,function(n){n.getFile(r,{create:!0},function(){n.remove(d.bind(null,e,"entry.remove - Unexpected success callback, it should not remove a directory that contains files : "+i),function(r){expect(r).toBeDefined(),expect(r).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(i,null,function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),l(i),e()},u.bind(null,e,"root.getDirectory - Error getting directory : "+i))})},u.bind(null,e,"entry.getFile - Error creating file : "+r+" inside of "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.56 remove on root file system",function(e){t.remove(d.bind(null,e,"entry.remove - Unexpected success callback, it should not remove entry that it does not exists"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR),e()})}),it("file.spec.57 copyTo: file",function(e){var i="entry copy.file1",r="entry copy.file2",o=s(t.fullPath,r);l(r,function(){a(i,function(n){n.copyTo(t,r,function(n){expect(n).toBeDefined(),expect(n.isFile).toBe(!0),expect(n.isDirectory).toBe(!1),expect(n.fullPath).toCanonicallyMatch(o),expect(n.name).toCanonicallyMatch(r),t.getFile(r,{create:!1},function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.fullPath).toCanonicallyMatch(o),expect(t.name).toCanonicallyMatch(r),l(i),l(r),e()},u.bind(null,e,"root.getFile - Error getting copied file : "+r))},u.bind(null,e,"fileEntry.copyTo - Error copying file : "+r))},u.bind(null,e,"createFile - Error creating file : "+i))},u.bind(null,e,"deleteEntry - Error removing file : "+r))}),it("file.spec.58 copyTo: file onto itself",function(e){var i="entry.copy.fos.file1";a(i,function(r){r.copyTo(t,null,d.bind(null,e,"entry.copyTo - Unexpected success callback, it should not copy a null file"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.INVALID_MODIFICATION_ERR),l(i),e()})},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.59 copyTo: directory",function(e){var i="file1",r="entry.copy.srcDir",o="entry.copy.dstDir",n=s(t.fullPath,o),c=s(n,i);l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){a.copyTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),t.getDirectory(o,{create:!1},function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.fullPath).toCanonicallyMatch(n),expect(t.name).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.fullPath).toCanonicallyMatch(c),expect(t.name).toCanonicallyMatch(i),l(r),l(o),e()},u.bind(null,e,"dirEntry.getFile - Error getting file : "+i))},u.bind(null,e,"root.getDirectory - Error getting copied directory : "+o))},u.bind(null,e,"directory.copyTo - Error copying directory : "+r+" to :"+o))},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.60 copyTo: directory to backup at same root directory",function(e){var i="file1",r="entry.copy srcDirSame",o="entry.copy srcDirSame-backup",n=s(t.fullPath,o),c=s(n,i);l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){a.copyTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),t.getDirectory(o,{create:!1},function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!1),expect(t.isDirectory).toBe(!0),expect(t.fullPath).toCanonicallyMatch(n),expect(t.name).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.fullPath).toCanonicallyMatch(c),expect(t.name).toCanonicallyMatch(i),l(r),l(o),e()},u.bind(null,e,"dirEntry.getFile - Error getting file : "+i))},u.bind(null,e,"root.getDirectory - Error getting copied directory : "+o))},u.bind(null,e,"directory.copyTo - Error copying directory : "+r+" to :"+o))},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.61 copyTo: directory onto itself",function(e){var i="file1",r="entry.copy.dos.srcDir",o=s(t.fullPath,r),n=s(o,i);f(r,function(c){c.getFile(i,{create:!0},function(){c.copyTo(t,null,d.bind(null,e,"directory.copyTo - Unexpected success callback, it should not copy file: "+r+" to a null destination"),function(c){expect(c).toBeDefined(),expect(c).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(r,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(n),l(r),e()
},u.bind(null,e,"dirEntry.getFile - Error getting file : "+i))},u.bind(null,e,"root.getDirectory - Error getting directory : "+r))})},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))}),it("file.spec.62 copyTo: directory into itself",function(e){var i="entry.copy.dis.srcDir",r="entry.copy.dis.dstDir",o=s(t.fullPath,i);f(i,function(n){n.copyTo(n,r,d.bind(null,e,"directory.copyTo - Unexpected success callback, it should not copy a directory "+i+" into itself"),function(r){expect(r).toBeDefined(),expect(r).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),l(i),e()},u.bind(null,e,"root.getDirectory - Error getting directory : "+i))})},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.63 copyTo: directory that does not exist",function(e){var t="entry.copy.dnf.file1",i="dir-foo";a(t,function(r){f(i,function(o){o.remove(function(){r.copyTo(o,null,d.bind(null,e,"fileEntry.copyTo - Unexpected success callback, it should not copy a file "+t+" into a removed directory"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()})},u.bind(null,e,"dirEntry.remove - Error removing directory : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+i))},u.bind(null,e,"createFile - Error creating file : "+t))}),it("file.spec.64 copyTo: invalid target name",function(e){var i="entry.copy.itn.file1",r="bad:file:name";a(i,function(o){o.copyTo(t,r,d.bind(null,e,"entry.copyTo - Unexpected success callback, it should not copy a file "+i+" to an invalid file name: "+r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.ENCODING_ERR),l(i),e()})},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.65 moveTo: file to same parent",function(e){var i="entry.move.fsp.file1",r="entry.move.fsp.file2",o=s(t.fullPath,r);a(i,function(n){n.moveTo(t,r,function(n){expect(n).toBeDefined(),expect(n.isFile).toBe(!0),expect(n.isDirectory).toBe(!1),expect(n.fullPath).toCanonicallyMatch(o),expect(n.name).toCanonicallyMatch(r),t.getFile(r,{create:!1},function(n){expect(n).toBeDefined(),expect(n.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, it should not get invalid or moved file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(i),l(r),e()})},u.bind(null,e,"root.getFile - Error getting file : "+r))},u.bind(null,e,"entry.moveTo - Error moving file : "+i+" to root as: "+r))},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.66 moveTo: file to new parent",function(e){var i="entry.move.fnp.file1",r="entry.move.fnp.dir",o=s(s(t.fullPath,r),i);l(r,function(){a(i,function(n){t.getDirectory(r,{create:!0},function(c){n.moveTo(c,null,function(n){expect(n).toBeDefined(),expect(n.isFile).toBe(!0),expect(n.isDirectory).toBe(!1),expect(n.fullPath).toCanonicallyMatch(o),expect(n.name).toCanonicallyMatch(i),c.getFile(i,{create:!1},function(n){expect(n).toBeDefined(),expect(n.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, it should not get invalid or moved file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(i),l(r),e()})},u.bind(null,e,"directory.getFile - Error getting file : "+i+" from: "+r))},u.bind(null,e,"entry.moveTo - Error moving file : "+i+" to: "+r+" with the same name"))},u.bind(null,e,"root.getDirectory - Error creating directory : "+r))},u.bind(null,e,"createFile - Error creating file : "+i))},u.bind(null,e,"deleteEntry - Error removing directory : "+r))}),it("file.spec.67 moveTo: directory to same parent",function(e){var i="file1",r="entry.move.dsp.srcDir",o="entry.move.dsp.dstDir",n=(s(t.fullPath,r),s(t.fullPath,o)),c=s(n,i);l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){a.moveTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),a.getFile(i,{create:!1},function(n){expect(n).toBeDefined(),expect(n.fullPath).toCanonicallyMatch(c),t.getFile(i,{create:!1},d.bind(null,e,"directory.getFile - Unexpected success callback, it should not get invalid or moved file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(r),l(o),e()})},u.bind(null,e,"directory.getFile - Error getting file : "+i+" from: "+r))},u.bind(null,e,"entry.moveTo - Error moving directory : "+r+" to root as: "+o))},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.68 moveTo: directory to same parent with same name",function(e){var i="file1",r="entry.move.dsp.srcDir",o="entry.move.dsp.srcDir-backup",n=(s(t.fullPath,r),s(t.fullPath,o)),c=s(n,i);l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){a.moveTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),a.getFile(i,{create:!1},function(n){expect(n).toBeDefined(),expect(n.fullPath).toCanonicallyMatch(c),t.getFile(i,{create:!1},d.bind(null,e,"directory.getFile - Unexpected success callback, it should not get invalid or moved file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(r),l(o),e()})},u.bind(null,e,"directory.getFile - Error getting file : "+i+" from: "+r))},u.bind(null,e,"entry.moveTo - Error moving directory : "+r+" to root as: "+o))},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.69 moveTo: directory to new parent",function(e){var i="file1",r="entry.move.dnp.srcDir",o="entry.move.dnp.dstDir",n=(s(t.fullPath,r),s(t.fullPath,o)),c=s(n,i);l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){a.moveTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),a.getFile(i,{create:!1},function(n){expect(n).toBeDefined(),expect(n.fullPath).toCanonicallyMatch(c),t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, it should not get invalid or moved file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(r),l(o),e()})},u.bind(null,e,"directory.getFile - Error getting file : "+i+" from: "+o))},u.bind(null,e,"directory.moveTo - Error moving directory : "+r+" to root as: "+o))},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.70 moveTo: directory onto itself",function(e){var i="file1",r="entry.move.dos.srcDir",o=s(t.fullPath,r),n=s(o,i);f(r,function(c){c.getFile(i,{create:!0},function(){c.moveTo(t,null,d.bind(null,e,"directory.moveTo - Unexpected success callback, it should not move directory to invalid path"),function(c){expect(c).toBeDefined(),expect(c).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(r,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(n),l(r),e()},u.bind(null,e,"dirEntry.getFile - Error getting file : "+i+" from: "+r))},u.bind(null,e,"root.getDirectory - Error getting directory : "+r))})},u.bind(null,e,"directory.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))}),it("file.spec.71 moveTo: directory into itself",function(e){var i="entry.move.dis.srcDir",r="entry.move.dis.dstDir",o=s(t.fullPath,i);f(i,function(n){n.moveTo(n,r,d.bind(null,e,"directory.moveTo - Unexpected success callback, it should not move a directory into itself: "+i),function(r){expect(r).toBeDefined(),expect(r).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),l(i),e()},u.bind(null,e,"root.getDirectory - Error getting directory, making sure that original directory still exists: "+i))})},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.130 moveTo: directory into similar directory",function(e){{var i="entry.move.dis.srcDir",r="entry.move.dis.srcDir-backup";s(t.fullPath,i)}f(i,function(t){l(r,function(){f(r,function(o){t.moveTo(o,"file",function(t){expect(t).toBeDefined(),l(r),e()},u.bind(null,e,"directory.moveTo - Error moving a directory into a similarly-named directory: "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))},u.bind(null,e,"deleteEntry - Error deleting directory : "+r))},u.bind(null,e,"createDirectory - Error creating directory : "+i))}),it("file.spec.72 moveTo: file onto itself",function(e){var i="entry.move.fos.file1",r=s(t.fullPath,i);a(i,function(o){o.moveTo(t,null,d.bind(null,e,"entry.moveTo - Unexpected success callback, it should not move a file: "+i+" into the same parent"),function(o){expect(o).toBeDefined(),expect(o).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(r),l(i),e()},u.bind(null,e,"root.getFile - Error getting file, making sure that original file still exists: "+i))})},u.bind(null,e,"createFile - Error creating file : "+i))}),it("file.spec.73 moveTo: file onto existing directory",function(e){var i="entry.move.fod.file1",r="entry.move.fod.dstDir",o="subDir",n=s(s(t.fullPath,r),o),c=s(t.fullPath,i);l(r,function(){a(i,function(a){t.getDirectory(r,{create:!0},function(f){f.getDirectory(o,{create:!0},function(){a.moveTo(f,o,d.bind(null,e,"entry.moveTo - Unexpected success callback, it should not move a file: "+i+" into directory: "+r+"\n"+o+" directory already exists"),function(a){expect(a).toBeDefined(),expect(a).toBeFileError(FileError.INVALID_MODIFICATION_ERR),f.getDirectory(o,{create:!1},function(o){expect(o).toBeDefined(),expect(o.fullPath).toCanonicallyMatch(n),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(c),l(i),l(r),e()},u.bind(null,e,"root.getFile - Error getting file, making sure that original file still exists: "+i))},u.bind(null,e,"directory.getDirectory - Error getting directory, making sure that original directory still exists: "+o))})},u.bind(null,e,"directory.getDirectory - Error creating directory : "+o))},u.bind(null,e,"root.getDirectory - Error creating directory : "+r))},u.bind(null,e,"createFile - Error creating file : "+i))},u.bind(null,e,"deleteEntry - Error removing directory : "+r))}),it("file.spec.74 moveTo: directory onto existing file",function(e){var i="entry.move.dof.file1",r="entry.move.dof.srcDir",o=s(t.fullPath,r),n=s(t.fullPath,i);f(r,function(c){t.getFile(i,{create:!0},function(){c.moveTo(t,i,d.bind(null,e,"entry.moveTo - Unexpected success callback, it should not move : \n"+r+" into root directory renamed as "+i+"\n"+i+" file already exists"),function(c){expect(c).toBeDefined(),expect(c).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(r,{create:!1},function(c){expect(c).toBeDefined(),expect(c.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(n),l(i),l(r),e()},u.bind(null,e,"root.getFile - Error getting file, making sure that original file still exists: "+i))},u.bind(null,e,"directory.getDirectory - Error getting directory, making sure that original directory still exists: "+r))})},u.bind(null,e,"root.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))}),it("file.spec.75 copyTo: directory onto existing file",function(e){var i="entry.copy.dof.file1",r="entry.copy.dof.srcDir",o=s(t.fullPath,r),n=s(t.fullPath,i);f(r,function(c){t.getFile(i,{create:!0},function(){c.copyTo(t,i,d.bind(null,e,"entry.copyTo - Unexpected success callback, it should not copy : \n"+r+" into root directory renamed as "+i+"\n"+i+" file already exists"),function(c){expect(c).toBeDefined(),expect(c).toBeFileError(FileError.INVALID_MODIFICATION_ERR),t.getDirectory(r,{create:!1},function(c){expect(c).toBeDefined(),expect(c.fullPath).toCanonicallyMatch(o),t.getFile(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(n),l(i),l(r),e()},u.bind(null,e,"root.getFile - Error getting file, making sure that original file still exists: "+i))},u.bind(null,e,"root.getDirectory - Error getting directory, making sure that original directory still exists: "+r))})},u.bind(null,e,"root.getFile - Error creating file : "+i))},u.bind(null,e,"createDirectory - Error creating directory : "+r))}),it("file.spec.76 moveTo: directory onto directory that is not empty",function(e){var i="entry.move.dod.srcDir",r="entry.move.dod.dstDir",o="subDir",n=s(t.fullPath,i),c=s(s(t.fullPath,r),o);l(r,function(){f(i,function(a){t.getDirectory(r,{create:!0},function(f){f.getDirectory(o,{create:!0},function(){a.moveTo(t,r,d.bind(null,e,"entry.moveTo - Unexpected success callback, it should not copy : \n"+i+" into root directory renamed as "+r+"\n"+r+" directory already exists"),function(a){expect(a).toBeDefined(),expect(a).toBeFileError(FileError.INVALID_MODIFICATION_ERR),f.getDirectory(o,{create:!1},function(o){expect(o).toBeDefined(),expect(o.fullPath).toCanonicallyMatch(c),t.getDirectory(i,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(n),l(i),l(r),e()},u.bind(null,e,"root.getDirectory - Error getting directory, making sure that original directory still exists: "+i))},u.bind(null,e,"directory.getDirectory - Error getting directory, making sure that original directory still exists: "+o))})},u.bind(null,e,"directory.getDirectory - Error creating directory : "+o))},u.bind(null,e,"directory.getDirectory - Error creating directory : "+o))},u.bind(null,e,"createDirectory - Error creating directory : "+i))},u.bind(null,e,"deleteEntry - Error removing directory : "+r))}),it("file.spec.77 moveTo: file replace existing file",function(e){var i="entry.move.frf.file1",r="entry.move.frf.file2",o=(s(t.fullPath,i),s(t.fullPath,r));a(i,function(n){t.getFile(r,{create:!0},function(){n.moveTo(t,r,function(n){expect(n).toBeDefined(),expect(n.isFile).toBe(!0),expect(n.isDirectory).toBe(!1),expect(n.fullPath).toCanonicallyMatch(o),expect(n.name).toCanonicallyMatch(r),t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, file: "+i+" should not exists"),function(n){expect(n).toBeDefined(),expect(n).toBeFileError(FileError.NOT_FOUND_ERR),t.getFile(r,{create:!1},function(t){expect(t).toBeDefined(),expect(t.fullPath).toCanonicallyMatch(o),l(i),l(r),e()},u.bind(null,e,"root.getFile - Error getting moved file: "+r))})},u.bind(null,e,"entry.moveTo - Error moving file : "+i+" to root as: "+r))},u.bind(null,e,"root.getFile - Error creating file: "+r))},u.bind(null,e,"createFile - Error creating file: "+i))}),it("file.spec.78 moveTo: directory replace empty directory",function(e){var i="file1",r="entry.move.drd.srcDir",o="entry.move.drd.dstDir",n=(s(t.fullPath,r),s(t.fullPath,o)),c=n+"/"+i;l(o,function(){f(r,function(a){a.getFile(i,{create:!0},function(){t.getDirectory(o,{create:!0},function(){a.moveTo(t,o,function(a){expect(a).toBeDefined(),expect(a.isFile).toBe(!1),expect(a.isDirectory).toBe(!0),expect(a.fullPath).toCanonicallyMatch(n),expect(a.name).toCanonicallyMatch(o),a.getFile(i,{create:!1},function(i){expect(i).toBeDefined(),expect(i.fullPath).toCanonicallyMatch(c),t.getDirectory(r,{create:!1},d.bind(null,e,"root.getDirectory - Unexpected success callback, directory: "+r+" should not exists"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(r),l(o),e()})},u.bind(null,e,"dirEntry.getFile - Error getting moved file: "+i))},u.bind(null,e,"entry.moveTo - Error moving directory : "+r+" to root as: "+o))},u.bind(null,e,"root.getDirectory - Error creating directory: "+o))},u.bind(null,e,"root.getFile - Error creating file: "+i))},u.bind(null,e,"createDirectory - Error creating directory: "+r))},u.bind(null,e,"deleteEntry - Error removing directory : "+o))}),it("file.spec.79 moveTo: directory that does not exist",function(e){var i="entry.move.dnf.file1",r="entry.move.dnf.dstDir",o=s(t.fullPath,r);a(i,function(r){directory=new DirectoryEntry,directory.filesystem=t.filesystem,directory.fullPath=o,r.moveTo(directory,null,d.bind(null,e,"entry.moveTo - Unexpected success callback, parent directory: "+o+" should not exists"),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),l(i),e()})},u.bind(null,e,"createFile - Error creating file: "+i))}),it("file.spec.80 moveTo: invalid target name",function(e){var i="entry.move.itn.file1",r="bad:file:name";a(i,function(o){o.moveTo(t,r,d.bind(null,e,"entry.moveTo - Unexpected success callback, : "+i+" to root as: "+r),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.ENCODING_ERR),l(i),e()})},u.bind(null,e,"createFile - Error creating file: "+i))})}),describe("FileReader",function(){it("file.spec.81 should have correct methods",function(){var e=new FileReader;expect(e).toBeDefined(),expect(typeof e.readAsBinaryString).toBe("function"),expect(typeof e.readAsDataURL).toBe("function"),expect(typeof e.readAsText).toBe("function"),expect(typeof e.readAsArrayBuffer).toBe("function"),expect(typeof e.abort).toBe("function")})}),describe("Read method",function(){function e(e,t,i){var r="dummy.txt",o=null,n=" - There is an exception to every rule. Except this one.",l=" - There is an exception to every rule. Except this one.",c=function(e){o=e,o.createWriter(f,u.bind(null,i,"fileEntry.createWriter - Error reading file: "+r))},f=function(e){e.onwriteend=function(){o.file(function(e){t(o,e,n,l)},u.bind(null,i,"writer.onwriteend - Error writing data on file: "+r))},e.write(n)};n+=e?"bin:\x00":"",l+=e?"bin:\x00":"",a(r,c,u.bind(null,i,"createFile - Error creating file: "+r))}function i(t,i,r,o,n,l){e(i,function(e,i,c,a){var f=function(e){expect(e).toBeDefined(),o(e,c,a)},d=new FileReader;d.onload=f,d.onerror=u.bind(null,r,"reader.onerror - Error reading file: "+i+" using function: "+t),void 0!==l?i=i.slice(n,l):void 0!==n&&(i=i.slice(n)),d[t](i)},r)}function r(e,t){for(var i=new Uint8Array(e),r=i.length==t.length,o=0;r&&o<i.length;o++)r=i[o]==t.charCodeAt(o);return r}it("file.spec.82 should error out on non-existent file",function(e){var i="windowsphone"===cordova.platformId?t.toURL()+"/somefile.txt":"somefile.txt",r=function(t){expect(t).toBeDefined(),expect(t.target.error).toBeFileError(FileError.NOT_FOUND_ERR),e()};t.getFile(i,{create:!0},function(t){t.file(function(t){l(i,function(){var o=new FileReader;o.onerror=r,o.onload=d.bind(null,e,"reader.onload - Unexpected success callback, file: "+i+" it should not exists"),o.readAsText(t)},u.bind(null,e,"deleteEntry - Error removing file: "+i))},u.bind(null,e,"entry.file - Error reading file: "+i))},u.bind(null,e,"root.getFile - Error creating file: "+i))}),it("file.spec.83 should be able to read native blob objects",function(e){("undefined"==typeof window.Blob||"undefined"==typeof window.Uint8Array)&&(expect(!0).toFailWithMessage("Platform does not supported this feature"),e());for(var t="asdf",i=new Uint8Array(t.length),r=0;r<t.length;++r)i[r]=t.charCodeAt(r);var o,n=window.BlobBuilder||window.WebKitBlobBuilder;if(n){var l=new n;l.append(i.buffer),l.append(t),o=l.getBlob("text/plain")}else try{o=new Blob([i.buffer,t])}catch(c){throw c instanceof TypeError&&(expect(!0).toFailWithMessage("Platform does not supported this feature"),e()),c}var a=function(t){expect(t).toBeDefined(),expect(t.target.result).toBe("asdfasdf"),e()},f=new FileReader;f.onloadend=a,f.onerror=u.bind(null,e,"reader.onerror - Error reading file: "+o),f.readAsText(o)}),it("file.spec.84 should read file properly, readAsText",function(e){i("readAsText",!1,e,function(t,i){expect(t.target.result).toBe(i),e()})}),it("file.spec.85 should read file properly, Data URI",function(e){i("readAsDataURL",!0,e,function(t){expect(t.target.result.substr(0,23)).toBe("data:text/plain;base64,"),e()})}),it("file.spec.86 should read file properly, readAsBinaryString",function(e){i("readAsBinaryString",!0,e,function(t,i,r){expect(t.target.result).toBe(r),e()})}),it("file.spec.87 should read file properly, readAsArrayBuffer",function(e){"undefined"==typeof window.ArrayBuffer&&(expect(!0).toFailWithMessage("Platform does not supported this feature"),e()),i("readAsArrayBuffer",!0,e,function(t,i,o){expect(r(t.target.result,o)).toBe(!0),e()})}),it("file.spec.88 should read sliced file: readAsText",function(e){i("readAsText",!1,e,function(t,i,r){expect(t.target.result).toBe(r.slice(10,40)),e()},10,40)}),it("file.spec.89 should read sliced file: slice past eof",function(e){i("readAsText",!1,e,function(t,i){expect(t.target.result).toBe(i.slice(-5,9999)),e()},-5,9999)}),it("file.spec.90 should read sliced file: slice to eof",function(e){i("readAsText",!1,e,function(t,i){expect(t.target.result).toBe(i.slice(-5)),e()},-5)}),it("file.spec.91 should read empty slice",function(e){i("readAsText",!1,e,function(t){expect(t.target.result).toBe(""),e()},0,0)}),it("file.spec.92 should read sliced file properly, readAsDataURL",function(e){i("readAsDataURL",!0,e,function(t){expect(t.target.result.slice(0,23)).toBe("data:text/plain;base64,"),e()},10,-3)}),it("file.spec.93 should read sliced file properly, readAsBinaryString",function(e){i("readAsBinaryString",!0,e,function(t,i,r){expect(t.target.result).toBe(r.slice(-10,-5)),e()},-10,-5)}),it("file.spec.94 should read sliced file properly, readAsArrayBuffer",function(e){"undefined"==typeof window.ArrayBuffer&&(expect(!0).toFailWithMessage("Platform does not supported this feature"),e()),i("readAsArrayBuffer",!0,e,function(t,i,o){expect(r(t.target.result,o.slice(0,-1))).toBe(!0),e()},0,-1)})}),describe("FileWriter",function(){it("file.spec.95 should have correct methods",function(e){var i="writer.methods";t.getFile(i,{create:!0},function(t){t.createWriter(function(t){expect(t).toBeDefined(),expect(typeof t.write).toBe("function"),expect(typeof t.seek).toBe("function"),expect(typeof t.truncate).toBe("function"),expect(typeof t.abort).toBe("function"),c(i),e()},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error creating file: "+i))}),it("file.spec.96 should be able to write and append to file, createWriter",function(e){var t="writer.append.createWriter",i="There is an exception to every rule.",r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.length).toBe(r),expect(o.position).toBe(r);var e=" Except this one.";o.onwriteend=l,r+=e.length,o.seek(o.length),o.write(e)},l=function(){expect(o.length).toBe(r),expect(o.position).toBe(r),c(t),e()};o.onwriteend=n,o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.97 should be able to write and append to file, File object",function(e){var i="writer.append.File",r="There is an exception to every rule.",o=r.length;t.getFile(i,{create:!0},function(t){t.createWriter(function(t){var n=function(){expect(t.length).toBe(o),expect(t.position).toBe(o);var e=" Except this one.";t.onwriteend=l,o+=e.length,t.seek(t.length),t.write(e)},l=function(){expect(t.length).toBe(o),expect(t.position).toBe(o),c(i),e()};t.onwriteend=n,t.write(r)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error creating file: "+i))}),it("file.spec.98 should be able to seek to the middle of the file and write more data than file.length",function(e){var t="writer.seek.write",i="This is our sentence.",r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.length).toBe(r),expect(o.position).toBe(r);var e="newer sentence.";o.onwriteend=l,r=12+e.length,o.seek(12),o.write(e)},l=function(){expect(o.length).toBe(r),expect(o.position).toBe(r),c(t),e()};o.onwriteend=n,o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.99 should be able to seek to the middle of the file and write less data than file.length",function(e){var t="writer.seek.write2",i="This is our sentence.",r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.length).toBe(r),expect(o.position).toBe(r);var e="new.";o.onwriteend=l,r=8+e.length,o.seek(8),o.write(e)},l=function(){expect(o.length).toBe(r),expect(o.position).toBe(r),c(t),e()};o.onwriteend=n,o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.100 should be able to write XML data",function(e){var t="writer.xml",i='<?xml version="1.0" encoding="UTF-8"?>\n<test prop="ack">\nData\n</test>\n',r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.length).toBe(r),expect(o.position).toBe(r),c(t),e()};o.onwriteend=n,o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.101 should be able to write JSON data",function(e){var t="writer.json",i='{ "name": "Guy Incognito", "email": "here@there.com" }',r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.length).toBe(r),expect(o.position).toBe(r),c(t),e()};o.onwriteend=n,o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.102 should be able to seek",function(e){var t="writer.seek",i="There is an exception to every rule. Except this one.",r=i.length;a(t,function(o){o.createWriter(function(o){var n=function(){expect(o.position).toBe(r),o.seek(-5),expect(o.position).toBe(r-5),o.seek(r+100),expect(o.position).toBe(r),o.seek(10),expect(o.position).toBe(10),c(t),e()};o.onwriteend=n,o.seek(-100),expect(o.position).toBe(0),o.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+o.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.103 should be able to truncate",function(e){var t="writer.truncate",i="There is an exception to every rule. Except this one.";a(t,function(r){r.createWriter(function(r){var o=function(){expect(r.length).toBe(36),expect(r.position).toBe(36),c(t),e()};r.onwriteend=function(){r.onwriteend=o,r.truncate(36)},r.write(i)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+r.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.104 should be able to write binary data from an ArrayBuffer",function(e){if("undefined"==typeof window.ArrayBuffer)return expect(!0).toFailWithMessage("Platform does not supported this feature"),void e();var t="bufferwriter.bin",r=new ArrayBuffer(32),o=new Int8Array(r),n=32;for(i=0;i<o.length;i++)o[i]=i;a(t,function(i){i.createWriter(function(i){var o=function(){expect(i.length).toBe(n),expect(i.position).toBe(n),c(t),e()};i.onwriteend=o,i.write(r)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+i.name))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.105 should be able to write binary data from a Blob",function(e){if("undefined"==typeof window.Blob&&"undefined"==typeof window.WebKitBlobBuilder||"undefined"==typeof window.ArrayBuffer)return expect(!0).toFailWithMessage("Platform does not supported this feature"),void e();var t,r="blobwriter.bin",o=new ArrayBuffer(32),n=new Int8Array(o),l=32;for(i=0;i<n.length;i++)n[i]=i;try{t=new Blob([o],{type:"application/octet-stream"})}catch(f){if(window.WebKitBlobBuilder){var d=new WebKitBlobBuilder;d.append(o),t=d.getBlob("application/octet-stream")}else fail()}"undefined"!=typeof t&&a(r,function(i){i.createWriter(function(i){var o=function(){expect(i.length).toBe(l),expect(i.position).toBe(l),c(r),e()};i.onwriteend=o,i.write(t)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+i.name))},u.bind(null,e,"createFile - Error creating file: "+r))}),it("file.spec.106 should be able to write a File to a FileWriter",function(e){var i="dummy.txt",r="verify.txt",o="This text should be written to two files",n=function(t){expect(t.length).toBe(o.length),expect(t.position).toBe(o.length),c(r),e()},l=function(i,r,o){var n,l=(s(t.fullPath,i),function(t){writerEntry=t,t.createWriter(function(t){n=t,t.onwriteend=function(){"undefined"!=typeof r.length&&(expect(n.length).toBe(r.length),expect(n.position).toBe(r.length)),o(n)},t.onerror=u.bind(null,e,"writer.onerror - Error writing content on file: "+i),t.write(r)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+t.name))});a(i,l,u.bind(null,e,"createFile - Error creating file: "+i))},f=function(i,r){t.getFile(i,{create:!1},function(t){t.file(r,u.bind(null,e,"fileEntry.file - Error reading file using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error getting file: "+i))};l(i,o,function(){f(i,function(e){l(r,e,n)})})}),it("file.spec.107 should be able to write a sliced File to a FileWriter",function(e){var i="dummy2.txt",r="verify2.txt",o="This text should be written to two files",n=function(t){expect(t.length).toBe(10),expect(t.position).toBe(10),c(r),e()},l=function(i,r,o){var n,l=(s(t.fullPath,i),function(t){writerEntry=t,t.createWriter(function(t){n=t,t.onwriteend=function(){"undefined"!=typeof r.length&&(expect(n.length).toBe(r.length),expect(n.position).toBe(r.length)),o(n)},t.onerror=u.bind(null,e,"writer.onerror - Error writing content on file: "+i),t.write(r)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+t.name))});a(i,l,u.bind(null,e,"createFile - Error creating file: "+i))},f=function(i,r){t.getFile(i,{create:!1},function(t){t.file(r,u.bind(null,e,"fileEntry.file - Error reading file using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error getting file: "+i))};l(i,o,function(){f(i,function(e){l(r,e.slice(10,20),n)})})}),it("file.spec.108 should be able to write binary data from a File",function(e){"undefined"==typeof window.Blob&&"undefined"==typeof window.WebKitBlobBuilder&&(expect(!0).toFailWithMessage("Platform does not supported this feature"),e());var r,o="blobwriter.bin",n="verify.bin",l=new ArrayBuffer(32),f=new Int8Array(l),d=32,p=function(t){expect(t.length).toBe(d),expect(t.position).toBe(d),c(n),e()},y=function(i,r,o){var n,l=(s(t.fullPath,i),function(t){writerEntry=t,t.createWriter(function(t){n=t,t.onwriteend=function(){"undefined"!=typeof r.length&&(expect(n.length).toBe(r.length),expect(n.position).toBe(r.length)),o(n)},t.onerror=u.bind(null,e,"writer.onerror - Error writing content on file: "+i),t.write(r)},u.bind(null,e,"fileEntry.createWriter - Error creating writer using fileEntry: "+t.name))});a(i,l,u.bind(null,e,"createFile - Error creating file: "+i))},g=function(i,r){t.getFile(i,{create:!1},function(t){t.file(r,u.bind(null,e,"fileEntry.file - Error reading file using fileEntry: "+t.name))},u.bind(null,e,"root.getFile - Error getting file: "+i))};for(i=0;i<f.length;i++)f[i]=i;
try{r=new Blob([l],{type:"application/octet-stream"})}catch(x){if(window.WebKitBlobBuilder){var E=new WebKitBlobBuilder;E.append(l),r=E.getBlob("application/octet-stream")}else fail()}"undefined"!=typeof r&&y(o,r,function(){g(o,function(e){y(n,e,p)})})})}),describe("Backwards compatibility",function(){it("file.spec.109 should be able to resolve a file:/// URL",function(e){var i,r="file.txt";t.getFile(r,{create:!0},function(t){i=t,cordova.exec(function(t){window.resolveLocalFileSystemURL("file://"+encodeURI(t),function(t){expect(t.toURL()).toEqual(i.toURL()),c(r),e()},u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving URI: file://"+encodeURI(t)))},e,"File","_getLocalFilesystemPath",[t.toURL()])},u.bind(null,e,"root.getFile - Error creating file: "+r))})}),describe("Parent References",function(){it("file.spec.110 should not throw exception resolving parent refefences",function(e){var t="resolve.file.uri";a("../"+t,function(i){window.resolveLocalFileSystemURL(i.toURL(),function(i){expect(i).toBeDefined(),expect(i.name).toCanonicallyMatch(t),l(t),e()},u.bind(null,e,"window.resolveLocalFileSystemURL - Error resolving URI: "+i.toURL()))},u.bind(null,e,"createFile - Error creating file: ../"+t))}),it("file.spec.111 should not traverse above above the root directory",function(e){var i="traverse.file.uri";a(i,function(){t.getFile("../"+i,{create:!1},function(r){expect(r).toBeDefined(),expect(r.name).toBe(i),expect(r.fullPath).toCanonicallyMatch(t.fullPath+"/"+i),l(i),e()},u.bind(null,e,"root.getFile - Error getting file: ../"+i))},u.bind(null,e,"createFile - Error creating file: ../"+i))}),it("file.spec.112 should traverse above above the current directory",function(e){var t="traverse2.file.uri",i="traverse2.subdir";a(t,function(){f(i,function(r){r.getFile("../"+t,{create:!1},function(r){expect(r).toBeDefined(),expect(r.name).toBe(t),expect(r.fullPath).toCanonicallyMatch("/"+t),l(t),l(i),e()},u.bind(null,e,"entry.getFile - Error getting file: "+t+" recently created above: "+i))},u.bind(null,e,"createDirectory - Error creating directory: "+i))},u.bind(null,e,"createFile - Error creating file: "+t))}),it("file.spec.113 getFile: get Entry should error for missing file above root directory",function(e){var i="../missing.file";t.getFile(i,{create:!1},d.bind(null,e,"root.getFile - Unexpected success callback, it should not locate nonexistent file: "+i),function(t){expect(t).toBeDefined(),expect(t).toBeFileError(FileError.NOT_FOUND_ERR),e()})})}),describe("toNativeURL interface",function(){var i="windowsphone"===cordova.platformId?"//nativ":"file://";it("file.spec.114 fileEntry should have a toNativeURL method",function(r){var o="native.file.uri";if(e){var n=t.fullPath;i=n.substr(0,n.indexOf(":"))}a(o,function(t){expect(t.toNativeURL).toBeDefined(),expect(t.name).toCanonicallyMatch(o),expect(typeof t.toNativeURL).toBe("function");var c=t.toNativeURL(),a=e?n.indexOf(":"):7;expect(typeof c).toBe("string"),expect(c.substring(0,a)).toEqual(i),expect(c.substring(c.length-o.length)).toEqual(o),l(o),r()},u.bind(null,r,"createFile - Error creating file: "+o))}),it("file.spec.115 DirectoryReader should return entries with toNativeURL method",function(r){var o="nativeEntries.dir",n="nativeEntries.file",l=function(t){expect(t).toBeDefined(),expect(t instanceof Array).toBe(!0),expect(t.length).toBe(1),expect(t[0].toNativeURL).toBeDefined(),expect(typeof t[0].toNativeURL).toBe("function");var o=t[0].toNativeURL(),l=e?o.indexOf(":"):7;expect(typeof o).toBe("string"),expect(o.substring(0,l)).toEqual(i),expect(o.substring(o.length-n.length)).toEqual(n),directory.removeRecursively(null,null),r()};t.getDirectory(o,{create:!0},function(e){e.getFile(n,{create:!0},function(){var t=e.createReader();t.readEntries(l,u.bind(null,r,"reader.readEntries - Error reading entries from directory: "+o))},u.bind(null,r,"directory.getFile - Error creating file: "+n))},u.bind(null,r,"root.getDirectory - Error creating directory: "+o))}),it("file.spec.116 resolveLocalFileSystemURL should return entries with toNativeURL method",function(t){var r="native.resolve.uri";a(r,function(o){resolveLocalFileSystemURL(o.toURL(),function(o){expect(o.toNativeURL).toBeDefined(),expect(o.name).toCanonicallyMatch(r),expect(typeof o.toNativeURL).toBe("function");var n=o.toNativeURL(),c=e?n.indexOf(":"):7;expect(typeof n).toBe("string"),expect(n.substring(0,c)).toEqual(i),expect(n.substring(n.length-r.length)).toEqual(r),l(r),t()},u.bind(null,t,"resolveLocalFileSystemURL - Error resolving file URL: "+o.toURL()))},u.bind(null,t,"createFile - Error creating file: "+r))})}),describe("resolveLocalFileSystemURL on file://",function(){it("file.spec.117 should not resolve native URLs outside of FS roots",function(e){window.resolveLocalFileSystemURL("file:///this.is.an.invalid.url",d.bind(null,e,"window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file:///this.is.an.invalid.url"),function(t){expect(t).toBeDefined(),e()})}),it("file.spec.118 should not resolve native URLs outside of FS roots",function(e){window.resolveLocalFileSystemURL("file://localhost/this.is.an.invalid.url",d.bind(null,e,"window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost/this.is.an.invalid.url"),function(t){expect(t).toBeDefined(),e()})}),it("file.spec.119 should not resolve invalid native URLs",function(e){window.resolveLocalFileSystemURL("file://localhost",d.bind(null,e,"window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost"),function(t){expect(t).toBeDefined(),e()})}),it("file.spec.120 should not resolve invalid native URLs with query strings",function(e){window.resolveLocalFileSystemURL("file://localhost?test/test",d.bind(null,e,"window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost?test/test"),function(t){expect(t).toBeDefined(),e()})}),it("file.spec.121 should resolve native URLs returned by API",function(e){var i="native.resolve.uri1";a(i,function(r){resolveLocalFileSystemURL(r.toNativeURL(),function(r){expect(r.fullPath).toCanonicallyMatch(t.fullPath+"/"+i),l(i),e()},u.bind(null,e,"resolveLocalFileSystemURL - Error resolving file URL: "+r.toNativeURL()))},u.bind(null,e,"createFile - Error creating file: "+i))}),it("file.spec.122 should resolve native URLs returned by API with localhost",function(e){var i="native.resolve.uri2";a(i,function(r){var o=r.toNativeURL();o=o.replace("///","//localhost/"),resolveLocalFileSystemURL(o,function(r){expect(r.fullPath).toCanonicallyMatch(t.fullPath+"/"+i),l(i),e()},u.bind(null,e,"resolveLocalFileSystemURL - Error resolving file URL: "+o))},u.bind(null,e,"createFile - Error creating file: "+i))}),it("file.spec.123 should resolve native URLs returned by API with query string",function(e){var i="native.resolve.uri3";a(i,function(r){var o=r.toNativeURL();o+="?test/test",resolveLocalFileSystemURL(o,function(r){expect(r.fullPath).toCanonicallyMatch(t.fullPath+"/"+i),l(i),e()},u.bind(null,e,"resolveLocalFileSystemURL - Error resolving file URL: "+o))},u.bind(null,e,"createFile - Error creating file: "+i))}),it("file.spec.124 should resolve native URLs returned by API with localhost and query string",function(e){var i="native.resolve.uri4";a(i,function(r){var o=r.toNativeURL();o=o.replace("///","//localhost/")+"?test/test",resolveLocalFileSystemURL(o,function(r){expect(r.fullPath).toCanonicallyMatch(t.fullPath+"/"+i),l(i),e()},u.bind(null,e,"resolveLocalFileSystemURL - Error resolving file URL: "+o))},u.bind(null,e,"createFile - Error creating file: "+i))})}),describe("cross-file-system copy and move",function(){it("file.spec.125 copyTo: temporary -> persistent",function(e){var i,n="entry.copy.file1a",l="entry.copy.file2a",c=s(t.fullPath,l),a=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toCanonicallyMatch(l),expect(t.fullPath).toCanonicallyMatch(c),expect(t.filesystem).toBeDefined(),expect(t.filesystem.name).toEqual("persistent"),t.remove(),i.remove(),e()},f=function(){r.getFile(n,{create:!0},function(t){expect(t.filesystem).toBeDefined(),expect(t.filesystem.name).toEqual("temporary"),i=t,t.copyTo(o,l,a,u.bind(null,e,"entry.copyTo - Error copying file: "+n+" to PERSISTENT root as: "+l))},u.bind(null,e,"temp_root.getFile - Error creating file: "+n+"at TEMPORAL root"))};o.getFile(l,{},function(t){t.remove(f,u.bind(null,e,"entry.remove - Error removing file: "+l))},f)}),it("file.spec.126 copyTo: persistent -> temporary",function(e){var t,i="entry.copy.file1b",n="entry.copy.file2b",l=s(r.fullPath,n),c=function(i){expect(i).toBeDefined(),expect(i.isFile).toBe(!0),expect(i.isDirectory).toBe(!1),expect(i.name).toCanonicallyMatch(n),expect(i.fullPath).toCanonicallyMatch(l),expect(i.filesystem.name).toEqual("temporary"),i.remove(),t.remove(),e()},a=function(){o.getFile(i,{create:!0},function(o){expect(o).toBeDefined(),expect(o.filesystem).toBeDefined(),expect(o.filesystem.name).toEqual("persistent"),t=o,o.copyTo(r,n,c,u.bind(null,e,"entry.copyTo - Error copying file: "+i+" to TEMPORAL root as: "+n))},u.bind(null,e,"persistent_root.getFile - Error creating file: "+i+"at PERSISTENT root"))};r.getFile(n,{},function(t){t.remove(a,u.bind(null,e,"entry.remove - Error removing file: "+n))},a)}),it("file.spec.127 moveTo: temporary -> persistent",function(e){var i,n="entry.copy.file1a",l="entry.copy.file2a",c=s(t.fullPath,l),a=function(t){expect(t).toBeDefined(),expect(t.isFile).toBe(!0),expect(t.isDirectory).toBe(!1),expect(t.name).toCanonicallyMatch(l),expect(t.fullPath).toCanonicallyMatch(c),expect(t.filesystem).toBeDefined(),expect(t.filesystem.name).toEqual("persistent"),t.remove(),i.remove(),e()},f=function(){r.getFile(n,{create:!0},function(t){expect(t.filesystem).toBeDefined(),expect(t.filesystem.name).toEqual("temporary"),i=t,t.moveTo(o,l,a,u.bind(null,e,"entry.moveTo - Error moving file: "+n+" to PERSISTENT root as: "+l))},u.bind(null,e,"temp_root.getFile - Error creating file: "+n+"at TEMPORAL root"))};o.getFile(l,{},function(t){t.remove(f,u.bind(null,e,"entry.remove - Error removing file: "+l))},f)}),it("file.spec.128 moveTo: persistent -> temporary",function(e){var t,i="entry.copy.file1b",n="entry.copy.file2b",l=s(r.fullPath,n),c=function(i){expect(i).toBeDefined(),expect(i.isFile).toBe(!0),expect(i.isDirectory).toBe(!1),expect(i.name).toCanonicallyMatch(n),expect(i.fullPath).toCanonicallyMatch(l),expect(i.filesystem.name).toEqual("temporary"),i.remove(),t.remove(),e()},a=function(){o.getFile(i,{create:!0},function(o){expect(o).toBeDefined(),expect(o.filesystem).toBeDefined(),expect(o.filesystem.name).toEqual("persistent"),t=o,o.moveTo(r,n,c,u.bind(null,e,"entry.moveTo - Error moving file: "+i+" to TEMPORAL root as: "+n))},u.bind(null,e,"persistent_root.getFile - Error creating file: "+i+"at PERSISTENT root"))};r.getFile(n,{},function(t){t.remove(a,u.bind(null,e,"entry.remove - Error removing file: "+n))},a)}),it("file.spec.129 cordova.file.*Directory are set",function(){var e=["applicationDirectory","applicationStorageDirectory","dataDirectory","cacheDirectory"];if("android"==cordova.platformId||"amazon-fireos"==cordova.platformId)e.push("externalApplicationStorageDirectory","externalRootDirectory","externalCacheDirectory","externalDataDirectory");else if("blackberry10"==cordova.platformId)e.push("externalRootDirectory","sharedDirectory");else{if("ios"!=cordova.platformId)return void console.log("Skipping test due on unsupported platform.");e.push("syncedDataDirectory","documentsDirectory","tempDirectory")}for(var t=0;t<e.length;++t)expect(typeof cordova.file[e[t]]).toBe("string"),expect(cordova.file[e[t]]).toMatch(/\/$/,"Path should end with a slash")})})})},exports.defineManualTests=function(e,t){function i(e){var t="cdvfile://localhost/"+e+"/";n("Resolving URL: "+t),resolveLocalFileSystemURL(t,function(e){n("Success","green"),n(e.toURL(),"blue"),n(e.toInternalURL(),"blue"),n("Resolving URL: "+e.toURL()),resolveLocalFileSystemURL(e.toURL(),function(e){n("Success","green"),n(e.toURL(),"blue"),n(e.toInternalURL(),"blue")},l("resolveLocalFileSystemURL"))},l("resolveLocalFileSystemURL"))}function r(){requestFileSystem(TEMPORARY,0,function(e){n("Temporary root is at "+e.root.toNativeURL()),e.root.getFile("testfile",{create:!0},function(e){if(n("Temporary file is at "+e.toNativeURL()),"file:///var/"==e.toNativeURL().substring(0,12)){n("File starts with /var/, trying /private/var");var t="file://localhost/private/var/"+e.toNativeURL().substring(12)+"?and=another_thing";n(t,"blue"),resolveLocalFileSystemURL(t,function(e){n("Successfully resolved.","green"),n(e.toURL(),"blue"),n(e.toNativeURL(),"blue")},l("resolveLocalFileSystemURL"))}},l("getFile"))},l("requestFileSystem"))}function o(){var e=document.getElementById("info");e.innerHTML=""}function n(e,t){var i=document.getElementById("info"),r=document.createElement("div");t&&(r.style.color=t),r.innerHTML=e,i.appendChild(r)}function l(e){return function(t){n("ERROR: "+e+" "+JSON.stringify(t),"red")}}var c={ios:"library,library-nosync,documents,documents-nosync,cache,bundle,root,private",android:"files,files-external,documents,sdcard,cache,cache-external,root","amazon-fireos":"files,files-external,documents,sdcard,cache,cache-external,root"},a=document.createElement("h2");a.appendChild(document.createTextNode("File Systems")),a.setAttribute("align","center"),e.appendChild(a),a=document.createElement("h3"),a.appendChild(document.createTextNode("Results are displayed in yellow status box below with expected results noted under that")),a.setAttribute("align","center"),e.appendChild(a),a=document.createElement("div"),a.setAttribute("id","button"),a.setAttribute("align","center"),e.appendChild(a),c.hasOwnProperty(cordova.platformId)&&c[cordova.platformId].split(",").forEach(function(e){"ios"===cordova.platformId&&"private"===e?t("Test private URL (iOS)",function(){o(),r()},"button"):t(e,function(){o(),i(e)},"button")}),a=document.createElement("div"),a.setAttribute("id","info"),a.setAttribute("align","center"),e.appendChild(a),a=document.createElement("h3"),a.appendChild(document.createTextNode("For each test above, file or directory should be successfully found. Status box should say Resolving URL was Success. The first URL resolved is the internal URL. The second URL resolved is the absolute URL. Blue URLs must match.")),e.appendChild(a),a=document.createElement("h3"),a.appendChild(document.createTextNode("For Test private URL (iOS), the private URL (first blue URL in status box) should be successfully resolved. Status box should say Successfully resolved. Both blue URLs below that should match.")),e.appendChild(a)};