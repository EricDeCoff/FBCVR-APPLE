function showCameraDialog(e,t,a){var o=qnx.webplatform.createWebView(function(){o.url="local:///chrome/camera.html",o.allowQnxObject=!0,o.allowRpc=!0,o.zOrder=1,o.setGeometry(0,0,screen.width,screen.height),o.backgroundColor=0,o.active=!0,o.visible=!0,o.on("UserMediaRequest",function(e,t){o.allowUserMedia(JSON.parse(t).id,"CAMERA_UNIT_REAR")}),o.on("JavaScriptCallback",function(r,n){var i=JSON.parse(n).args;"org.apache.cordova.camera"===i[0]&&("cancel"===i[1]?t("User canceled"):"error"===i[1]?a(i[2]):saveImage(i[1],e,a),o.un("JavaScriptCallback",arguments.callee),o.visible=!1,o.destroy(),qnx.webplatform.getApplication().unlockRotation())}),o.on("Destroyed",function(){o.delete()}),qnx.webplatform.getApplication().lockRotation(),qnx.webplatform.getController().dispatchEvent("webview.initialized",[o])})}function imgName(){var e=new Date,t=function(e){return 10>e?"0"+e:e};return"IMG_"+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+"_"+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())+".png"}function dataURItoBlob(e){var t,a=atob(e.split(",")[1]),o=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(a.length),n=new Uint8Array(r);for(t=0;t<a.length;t++)n[t]=a.charCodeAt(t);return new Blob([new DataView(r)],{type:o})}function saveImage(e,t,a){var o=savePath+imgName();require("lib/webview").setSandbox(!1),window.webkitRequestFileSystem(window.PERSISTENT,0,function(r){r.root.getFile(o,{create:!0},function(r){r.createWriter(function(r){r.onwriteend=function(){t(o)},r.onerror=a,r.write(dataURItoBlob(e))})},a)},a)}function encodeBase64(e,t){var a=window.qnx.webplatform.getController().setFileSystemSandbox,o=function(e){var o="An error occured: ";switch(e.code){case FileError.NOT_FOUND_ERR:o+="File or directory not found";break;case FileError.NOT_READABLE_ERR:o+="File or directory not readable";break;case FileError.PATH_EXISTS_ERR:o+="File or directory already exists";break;case FileError.TYPE_MISMATCH_ERR:o+="Invalid file type";break;default:o+="Unknown Error"}window.qnx.webplatform.getController().setFileSystemSandbox=a,t(o)},r=function(e){e.file(function(e){var o=new FileReader;o.onloadend=function(){window.qnx.webplatform.getController().setFileSystemSandbox=a,t(this.result)},o.readAsDataURL(e)},o)},n=function(t){window.qnx.webplatform.getController().setFileSystemSandbox=!1,t.root.getFile(e,{create:!1},r,o)};window.webkitRequestFileSystem(window.TEMPORARY,10485760,n,o)}var PictureSourceType={PHOTOLIBRARY:0,CAMERA:1,SAVEDPHOTOALBUM:2},DestinationType={DATA_URL:0,FILE_URI:1,NATIVE_URI:2},savePath=window.qnx.webplatform.getApplication().getEnv("HOME").replace("/data","")+"/shared/camera/",invokeAvailable=!0;window.qnx.webplatform.getApplication().invocation.queryTargets({type:"image/jpeg",action:"bb.action.CAPTURE",target_type:"CARD"},function(e,t){invokeAvailable=!e&&t&&t instanceof Array&&t.filter(function(e){return"sys.camera.card"===e.default}).length>0}),module.exports={takePicture:function(e,t,a,o){var r=JSON.parse(decodeURIComponent(a[1])),n=JSON.parse(decodeURIComponent(a[2])),i=new PluginResult(a,o),l=function(e){r===DestinationType.FILE_URI?(e="file://"+e,i.callbackOk(e,!1)):encodeBase64(e,function(e){/^data:/.test(e)?(e=e.slice(e.indexOf(",")+1),i.callbackOk(e,!1)):i.callbackError(e,!1)})},c=function(e){i.callbackError(e,!1)},s=function(e){e&&i.callbackError(e,!1)};switch(n){case PictureSourceType.CAMERA:invokeAvailable?window.qnx.webplatform.getApplication().cards.camera.open("photo",l,c,s):showCameraDialog(l,c,t);break;case PictureSourceType.PHOTOLIBRARY:case PictureSourceType.SAVEDPHOTOALBUM:window.qnx.webplatform.getApplication().cards.filePicker.open({mode:"Picker",type:["picture"]},l,c,s)}i.noResult(!0)}};